<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 블로그 자동 생성기 - 사진만으로 완벽한 포스팅 작성</title>
    
    <!-- Supabase JavaScript SDK -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- Toss Payments SDK -->
    <script src="https://js.tosspayments.com/v1/payment-widget"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --primary-hover: #1d4ed8;
            --secondary-color: #64748b;
            --success-color: #059669;
            --error-color: #dc2626;
            --warning-color: #d97706;
            --background: #ffffff;
            --surface: #f8fafc;
            --border: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
        }

        [data-theme="dark"] {
            --background: #0f172a;
            --surface: #1e293b;
            --border: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .social-links {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            margin-right: 1rem;
        }

        .social-link {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border-radius: 6px;
            text-decoration: none;
            color: var(--text-secondary);
            transition: all 0.15s ease;
            border: 1px solid transparent;
            font-size: 14px;
            font-weight: 500;
        }

        .social-link:hover {
            background-color: var(--surface);
            border-color: var(--border);
            color: var(--text-primary);
            transform: translateY(-1px);
        }

        .social-link svg {
            transition: transform 0.15s ease;
        }

        .social-link:hover svg {
            transform: scale(1.1);
        }

        .sponsor-link {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            border: none;
        }

        .sponsor-link:hover {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
        }

        .youtube-link:hover {
            color: #ff0000;
        }

        .threads-link:hover {
            color: #000000;
        }

        [data-theme="dark"] .threads-link:hover {
            color: #ffffff;
        }

        /* Main Content */
        .main {
            min-height: calc(100vh - 160px);
            padding: 2rem 0;
        }

        .hero {
            text-align: center;
            margin-bottom: 3rem;
        }

        .hero h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--primary-color), #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        /* API Key Section */
        .api-key-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .api-key-section.error {
            border-color: var(--error-color);
            background: #fef2f2;
        }

        [data-theme="dark"] .api-key-section.error {
            background: #1f1a1a;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--background);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s ease;
            text-align: center;
            justify-content: center;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--surface);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--border);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-error {
            background: var(--error-color);
            color: white;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        /* Photo Upload */
        .photo-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .photo-item {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }

        .photo-preview {
            width: 150px;
            height: 100px;
            border: 2px dashed var(--border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
            overflow: hidden;
        }

        .photo-preview:hover {
            border-color: var(--primary-color);
            background: var(--surface);
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 6px;
        }

        .photo-content {
            flex: 1;
        }

        /* Language & Theme Controls */
        .select {
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--background);
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--background);
            border-radius: 12px;
            padding: 2rem;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* API 설정 모달 스타일 */
        .api-status {
            margin-bottom: 1.5rem;
        }

        .status-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid;
        }

        .status-card.success {
            background: #f0f9f0;
            border-color: #22c55e;
            color: #166534;
        }

        .status-card.error {
            background: #fef2f2;
            border-color: #ef4444;
            color: #991b1b;
        }

        [data-theme="dark"] .status-card.success {
            background: #0a2e0a;
            color: #4ade80;
        }

        [data-theme="dark"] .status-card.error {
            background: #2e0a0a;
            color: #f87171;
        }

        .status-icon {
            font-size: 1.5rem;
        }

        .status-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .status-desc {
            font-size: 0.875rem;
            opacity: 0.8;
        }

        .api-input-container {
            display: flex;
            gap: 0.5rem;
        }

        .api-input-container .form-input {
            flex: 1;
        }

        .api-guide {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
        }

        .guide-steps {
            margin: 1rem 0;
        }

        .guide-step {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            align-items: flex-start;
        }

        .guide-step:last-child {
            margin-bottom: 0;
        }

        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-content strong {
            display: block;
            margin-bottom: 0.25rem;
            color: var(--text-primary);
        }

        .step-content p {
            margin: 0.25rem 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .guide-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 6px;
            transition: all 0.2s ease;
            font-size: 0.875rem;
        }

        .guide-link:hover {
            background: var(--primary-color);
            color: white;
            text-decoration: none;
        }

        .api-info {
            border-top: 1px solid var(--border);
            padding-top: 1rem;
        }

        .info-item {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .info-item:last-child {
            margin-bottom: 0;
        }

        .info-item strong {
            color: var(--text-primary);
        }

        /* 포스팅 강화 기능 스타일 */
        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            margin: 2rem 0;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--border);
            z-index: 1;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: var(--background);
            padding: 0.5rem;
            z-index: 2;
            position: relative;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--border);
            color: var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: var(--primary-color);
            color: white;
        }

        .step.completed .step-number {
            background: var(--success-color);
            color: white;
        }

        .step-text {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-align: center;
            font-weight: 500;
        }

        .step.active .step-text {
            color: var(--primary-color);
            font-weight: 600;
        }

        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin: 1rem 0;
        }

        .comparison-section h4 {
            margin-bottom: 0.75rem;
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 600;
        }

        .content-box {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            max-height: 300px;
            overflow-y: auto;
            font-size: 0.875rem;
            line-height: 1.6;
        }

        .enhancement-summary {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
        }

        .reference-item {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.2s ease;
        }

        .reference-item:hover {
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .reference-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .reference-link {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .reference-link:hover {
            text-decoration: underline;
        }

        .reference-stats {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
            border: 1px solid var(--success-color);
        }

        .btn-success:hover {
            background: #047857;
            border-color: #047857;
        }

        @media (max-width: 768px) {
            .comparison-container {
                grid-template-columns: 1fr;
            }
            
            .progress-steps {
                flex-direction: column;
                gap: 1rem;
            }
            
            .progress-steps::before {
                display: none;
            }
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .tab {
            padding: 0.75rem 1rem;
            border: none;
            background: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Tone Adjuster */
        .tone-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .tone-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .photo-item {
                flex-direction: column;
            }
            
            .photo-preview {
                width: 100%;
                height: 150px;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .tone-controls {
                grid-template-columns: 1fr;
            }
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .text-error { color: var(--error-color); }
        .text-success { color: var(--success-color); }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mt-2 { margin-top: 1rem; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }
        .w-full { width: 100%; }

        /* Footer Styles */
        .footer {
            background: var(--surface);
            border-top: 1px solid var(--border);
            padding: 3rem 0 2rem 0;
            margin-top: 4rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            color: var(--text-primary);
            margin-bottom: 1rem;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .footer-section p {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .footer-section ul {
            list-style: none;
            padding: 0;
        }

        .footer-section li {
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 0.5rem;
        }

        .footer-section li:before {
            content: "✓";
            color: var(--primary-color);
            font-weight: bold;
            margin-right: 0.5rem;
        }

        .toggle-section {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .toggle-header {
            padding: 1rem 1.5rem;
            background: var(--surface);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s ease;
        }

        .toggle-header:hover {
            background: var(--border);
        }

        .toggle-header h4 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .toggle-icon {
            transition: transform 0.2s ease;
            color: var(--text-secondary);
        }

        .toggle-section.active .toggle-icon {
            transform: rotate(180deg);
        }

        .toggle-content {
            padding: 0 1.5rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }

        .toggle-section.active .toggle-content {
            max-height: 1000px;
            padding: 1rem 1.5rem 1.5rem 1.5rem;
        }

        .copyright {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Image Editor Styles */
        .image-container:hover .image-overlay {
            opacity: 1 !important;
        }

        .edit-image-btn:hover {
            background: rgba(255,255,255,1) !important;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2) !important;
        }

        .edit-image-btn:active {
            transform: translateY(0);
        }

        /* Image Editor Modal */
        .image-editor-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .image-editor-content {
            background: var(--surface);
            border-radius: 12px;
            padding: 2rem;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            border: 1px solid var(--border);
        }

        .image-editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .image-editor-header h3 {
            color: var(--text-primary);
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: var(--border);
            color: var(--text-primary);
        }

        .image-editor-preview {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .image-editor-preview img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .image-editor-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .image-editor-form label {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .image-editor-form textarea {
            width: 100%;
            min-height: 100px;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--background);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            transition: border-color 0.2s ease;
        }

        .image-editor-form textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .image-editor-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1rem;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .footer-content {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .toggle-header {
                padding: 0.75rem 1rem;
            }
            
            .toggle-section.active .toggle-content {
                padding: 1rem;
            }

            .image-editor-content {
                padding: 1.5rem;
                margin: 1rem;
            }

            .image-editor-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">AI 블로그 생성기</div>
                <div class="social-links">
                    <a href="https://litt.ly/mumulab1203" target="_blank" class="social-link sponsor-link" title="후원하기">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2 21l1.5-1.5C5.5 17.5 8 16 12 16s6.5 1.5 8.5 3.5L22 21c0 0-2-4-10-4S2 21 2 21zM12 13c1.1 0 2-.9 2-2 0-.5-.2-1-.5-1.4C12.8 8.6 12 7.9 12 7c0-.8.7-1.5 1.5-1.5S15 6.2 15 7c0 .4-.1.8-.3 1.1-.1.2-.2.4-.2.6 0 .3.1.5.3.7.5.5.7 1.2.7 1.9 0 1.1-.9 2-2 2s-2-.9-2-2c0-.7.3-1.4.7-1.9.2-.2.3-.4.3-.7 0-.2-.1-.4-.2-.6C10.1 7.8 10 7.4 10 7c0-.8.7-1.5 1.5-1.5S13 6.2 13 7c0 .9-.8 1.6-1.5 2.6-.3.4-.5.9-.5 1.4 0 1.1.9 2 2 2z"/>
                        </svg>
                        후원하기
                    </a>
                    <a href="https://www.youtube.com/@MUMULABKR" target="_blank" class="social-link youtube-link" title="무무랩 유튜브">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                        </svg>
                        무무랩 채널
                    </a>
                    <a href="https://www.threads.com/@lrinvl1203" target="_blank" class="social-link threads-link" title="무무랩 Threads">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12.186 24h-.007c-3.581-.024-6.334-1.205-8.184-3.509C2.35 18.44 1.5 15.586 1.5 12.4v-.045A10.56 10.56 0 0 1 12.007 2C18.623 2.001 22.5 5.88 22.5 12.395c-.001 4.5-2.702 8.596-6.892 10.432l-1.092-2.142C17.481 19.068 19.5 15.948 19.5 12.395 19.5 7.59 16.813 5 12.007 5s-7.493 2.59-7.493 7.395v.045c0 2.508.584 4.658 1.646 6.056C7.49 20.183 9.63 21 12.186 21h.007c1.92 0 3.75-.398 5.293-1.148l1.085 2.15A12.684 12.684 0 0 1 12.186 24zM12 8.395c2.206 0 4 1.794 4 4s-1.794 4-4 4-4-1.794-4-4 1.794-4 4-4z"/>
                        </svg>
                        무무랩
                    </a>
                </div>
                <div class="header-controls">
                    <select id="languageSelect" class="select">
                        <option value="ko">한국어</option>
                        <option value="en">English</option>
                        <option value="ja">日本語</option>
                        <option value="zh">中文</option>
                        <option value="es">Español</option>
                        <option value="fr">Français</option>
                    </select>
                    <button id="apiSetupBtn" class="btn btn-secondary btn-small" data-i18n="api_setup_button">🔑 API</button>
                    <div id="authContainer">
                        <button id="subscribeBtn" class="btn btn-success btn-small" onclick="openSubscriptionModal()">💎 구독</button>
                        <button id="loginBtn" class="btn btn-primary btn-small">🔐 로그인</button>
                        <div id="userProfile" class="user-profile" style="display: none;">
                            <div class="user-avatar">👤</div>
                            <span id="userEmail" class="user-email"></span>
                            <button id="logoutBtn" class="btn btn-secondary btn-small">로그아웃</button>
                        </div>
                    </div>
                    <button id="themeToggle" class="btn btn-secondary btn-small">🌙</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Hero Section -->
            <div class="hero">
                <h1 data-i18n="app_title">AI 블로그 자동 생성기 - 사진만으로 완벽한 포스팅 작성</h1>
                <p data-i18n="app_subtitle">사진을 업로드하고, 세부 정보를 추가하면 AI가 전문적인 블로그 글을 자동으로 작성해 드립니다.</p>
            </div>

            <!-- API Key Status (hidden by default) -->
            <div class="api-key-section hidden" id="apiKeySection">
                <div class="form-group">
                    <label class="form-label" data-i18n="api_key_label">Gemini API 키</label>
                    <input type="password" id="apiKey" class="form-input" placeholder="AIzaSy..." data-i18n-placeholder="api_key_placeholder">
                    <small style="color: var(--text-muted); margin-top: 0.5rem; display: block;" data-i18n="api_key_help">
                        Google AI Studio에서 무료로 API 키를 받을 수 있습니다.
                    </small>
                </div>
            </div>

            <!-- Main App Container -->
            <div id="appContainer">
                <!-- Blog Generator Form -->
                <div id="blogForm" class="form-section">
                    <div class="form-group">
                        <label class="form-label" data-i18n="form_category_label">블로그 카테고리</label>
                        <input type="text" id="category" class="form-input" data-i18n-placeholder="form_category_placeholder">
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-i18n="form_topic_label">주제 / 주요 아이디어</label>
                        <input type="text" id="topic" class="form-input" data-i18n-placeholder="form_topic_placeholder">
                    </div>

                    <div class="photo-section">
                        <h3 class="mb-2" data-i18n="form_photos_title">사진 & 설명</h3>
                        <div id="photoContainer"></div>
                        <button type="button" id="addPhotoBtn" class="btn btn-secondary">
                            ➕ <span data-i18n="form_add_photos_button">사진 추가하기</span>
                        </button>
                    </div>

                    <div class="text-center">
                        <button type="button" id="reviewBtn" class="btn btn-primary">
                            <span data-i18n="form_review_prompt_button">프롬프트 검토</span>
                        </button>
                    </div>
                </div>

                <!-- Loading Section -->
                <div id="loadingSection" class="hidden text-center">
                    <div class="spinner" style="width: 40px; height: 40px; margin-bottom: 1rem;"></div>
                    <p id="loadingMessage" style="color: var(--text-secondary);">AI의 창의력을 예열 중...</p>
                </div>

                <!-- Blog Output Section -->
                <div id="blogOutput" class="hidden">
                    <div class="flex justify-between items-center mb-2">
                        <h2 data-i18n="output_title">생성된 블로그 포스트</h2>
                        <div class="flex gap-1">
                            <button id="addContentBtn" class="btn btn-secondary btn-small">
                                <span data-i18n="output_add_modify_button">콘텐츠 추가/수정</span>
                            </button>
                            <button id="adjustToneBtn" class="btn btn-secondary btn-small">
                                <span data-i18n="output_adjust_tone_button">톤 조절</span>
                            </button>
                            <button id="createAnotherBtn" class="btn btn-secondary btn-small">
                                <span data-i18n="output_create_another_button">다른 블로그 포스트 만들기</span>
                            </button>
                            <button id="enhancePostBtn" class="btn btn-secondary btn-small">
                                ⚡ <span data-i18n="output_enhance_button">포스팅 강화</span>
                            </button>
                        </div>
                    </div>

                    <div class="tabs">
                        <button class="tab active" data-tab="preview" data-i18n="output_tab_preview">미리보기</button>
                        <button class="tab" data-tab="html" data-i18n="output_tab_html">HTML</button>
                        <button class="tab" data-tab="markdown" data-i18n="output_tab_markdown">마크다운</button>
                        <button class="tab" data-tab="text" data-i18n="output_tab_text">텍스트</button>
                    </div>

                    <div class="tab-content active" id="previewTab">
                        <div id="blogPreview" style="background: var(--surface); padding: 2rem; border-radius: 8px; border: 1px solid var(--border);"></div>
                    </div>

                    <div class="tab-content" id="htmlTab">
                        <div style="position: relative;">
                            <button class="btn btn-small btn-secondary" style="position: absolute; top: 10px; right: 10px; z-index: 10;" onclick="copyToClipboard('htmlContent')">
                                <span data-i18n="output_copy_html">HTML 복사</span>
                            </button>
                            <pre id="htmlContent" style="background: var(--surface); padding: 2rem; border-radius: 8px; border: 1px solid var(--border); overflow-x: auto; white-space: pre-wrap;"></pre>
                        </div>
                    </div>

                    <div class="tab-content" id="markdownTab">
                        <div style="position: relative;">
                            <button class="btn btn-small btn-secondary" style="position: absolute; top: 10px; right: 10px; z-index: 10;" onclick="copyToClipboard('markdownContent')">
                                <span data-i18n="output_copy_markdown">마크다운 복사</span>
                            </button>
                            <pre id="markdownContent" style="background: var(--surface); padding: 2rem; border-radius: 8px; border: 1px solid var(--border); overflow-x: auto; white-space: pre-wrap;"></pre>
                        </div>
                    </div>

                    <div class="tab-content" id="textTab">
                        <div style="position: relative;">
                            <button class="btn btn-small btn-secondary" style="position: absolute; top: 10px; right: 10px; z-index: 10;" onclick="copyToClipboard('textContent')">
                                <span data-i18n="output_copy_text">텍스트 복사</span>
                            </button>
                            <pre id="textContent" style="background: var(--surface); padding: 2rem; border-radius: 8px; border: 1px solid var(--border); overflow-x: auto; white-space: pre-wrap;"></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <!-- Image Editor Modal -->
    <div id="imageEditorModal" class="image-editor-modal" style="display: none;">
        <div class="image-editor-content">
            <div class="image-editor-header">
                <h3 data-i18n="image_editor_title">이미지 수정하기</h3>
                <button class="close-btn" onclick="closeImageEditor()">&times;</button>
            </div>
            
            <div class="image-editor-preview">
                <img id="editingImage" src="" alt="편집할 이미지">
            </div>
            
            <div class="image-editor-form">
                <label data-i18n="image_editor_prompt_label">수정 지시사항</label>
                <textarea id="imageEditPrompt" 
                          placeholder="예: 배경을 파란 하늘로 바꿔줘, 사람을 제거해줘, 더 밝게 만들어줘 등" 
                          data-i18n-placeholder="image_editor_prompt_placeholder"></textarea>
                
                <div class="image-editor-actions">
                    <button class="btn btn-secondary" onclick="closeImageEditor()" data-i18n="image_editor_cancel">취소</button>
                    <button class="btn btn-primary" onclick="confirmImageEdit()" data-i18n="image_editor_apply">변경 적용</button>
                </div>
            </div>
            
            <div id="imageEditingLoader" class="loading-overlay" style="display: none;">
                <div class="loading-spinner"></div>
            </div>
        </div>
    </div>

    <!-- Prompt Review Modal -->
    <div id="promptModal" class="modal">
        <div class="modal-content" style="width: 800px;">
            <h2 class="mb-2" data-i18n="review_title">프롬프트 검토</h2>
            <p class="mb-2" style="color: var(--text-secondary);" data-i18n="review_subtitle">AI가 이 프롬프트를 사용하여 블로그 포스트를 생성합니다. 아래에서 수정하여 지침을 구체화할 수 있습니다.</p>
            
            <div class="form-group">
                <label class="form-label" data-i18n="review_word_count_label">목표 글자 수</label>
                <select id="wordCountSelect" class="form-input">
                    <option value="800" data-i18n="review_wc_option_1">약 800자</option>
                    <option value="1500" data-i18n="review_wc_option_2">약 1500자</option>
                    <option value="2000" selected data-i18n="review_wc_option_3">약 2000자 (기본)</option>
                    <option value="2500" data-i18n="review_wc_option_4">약 2500자 이상</option>
                    <option value="custom" data-i18n="review_wc_option_5">직접 입력</option>
                </select>
                <input type="number" id="customWordCount" class="form-input mt-2 hidden" placeholder="1200" min="100" max="10000">
            </div>

            <div class="form-group">
                <label class="form-label">프롬프트</label>
                <textarea id="promptText" class="form-input form-textarea" rows="10"></textarea>
            </div>

            <div class="flex gap-2 justify-between">
                <button id="promptBackBtn" class="btn btn-secondary" data-i18n="review_back_button">양식으로 돌아가기</button>
                <button id="confirmGenerateBtn" class="btn btn-primary" data-i18n="review_confirm_button">확인 & 생성</button>
            </div>
        </div>
    </div>

    <!-- Add Content Modal -->
    <div id="addContentModal" class="modal">
        <div class="modal-content" style="width: 800px;">
            <h2 class="mb-2" data-i18n="output_addup_title">블로그 포스트에 내용 추가하기</h2>
            
            <div class="form-group">
                <label class="form-label" data-i18n="output_addup_instructions_label">추가 지침</label>
                <textarea id="addInstructions" class="form-input form-textarea" rows="4" data-i18n-placeholder="output_addup_instructions_placeholder"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label" data-i18n="output_addup_photos_title">사진 더 추가하기</label>
                <div id="additionalPhotos"></div>
                <button type="button" id="addMorePhotoBtn" class="btn btn-secondary btn-small mt-2">
                    ➕ <span data-i18n="output_addup_add_photo_field_button">사진 필드 추가</span>
                </button>
            </div>

            <div class="flex gap-2 justify-between">
                <button id="addContentCancelBtn" class="btn btn-secondary" data-i18n="output_addup_cancel_button">취소</button>
                <button id="addContentConfirmBtn" class="btn btn-primary" data-i18n="output_addup_regenerate_button">추가하여 다시 생성</button>
            </div>
        </div>
    </div>

    <!-- Tone Adjust Modal -->
    <div id="toneModal" class="modal">
        <div class="modal-content" style="width: 800px;">
            <h2 class="mb-2" data-i18n="tone_adjuster_title">블로그 글 톤 조절하기</h2>
            
            <div class="tone-controls">
                <div class="tone-group">
                    <label class="form-label" data-i18n="tone_formality">격식</label>
                    <select id="toneFormality" class="form-input">
                        <option value="일상적">일상적</option>
                        <option value="비공식적">비공식적</option>
                        <option value="중립적" selected>중립적</option>
                        <option value="공식적">공식적</option>
                        <option value="전문적">전문적</option>
                    </select>
                </div>

                <div class="tone-group">
                    <label class="form-label" data-i18n="tone_enthusiasm">열정</label>
                    <select id="toneEnthusiasm" class="form-input">
                        <option value="차분함">차분함</option>
                        <option value="평온함">평온함</option>
                        <option value="중립적" selected>중립적</option>
                        <option value="활기참">활기참</option>
                        <option value="열정적">열정적</option>
                    </select>
                </div>

                <div class="tone-group">
                    <label class="form-label" data-i18n="tone_confidence">자신감</label>
                    <select id="toneConfidence" class="form-input">
                        <option value="객관적">객관적</option>
                        <option value="신중함">신중함</option>
                        <option value="중립적" selected>중립적</option>
                        <option value="자신감있음">자신감있음</option>
                        <option value="단호함">단호함</option>
                    </select>
                </div>

                <div class="tone-group">
                    <label class="form-label" data-i18n="tone_humor">유머</label>
                    <select id="toneHumor" class="form-input">
                        <option value="진지함">진지함</option>
                        <option value="무미건조">무미건조</option>
                        <option value="중립적" selected>중립적</option>
                        <option value="재치있음">재치있음</option>
                        <option value="위트있음">위트있음</option>
                    </select>
                </div>

                <div class="tone-group">
                    <label class="form-label" data-i18n="tone_clarity">명확성</label>
                    <select id="toneClarity" class="form-input">
                        <option value="단순함">단순함</option>
                        <option value="간결함">간결함</option>
                        <option value="중립적" selected>중립적</option>
                        <option value="상세함">상세함</option>
                        <option value="전문적">전문적</option>
                    </select>
                </div>
            </div>

            <div class="flex gap-2 justify-between">
                <button id="toneCancelBtn" class="btn btn-secondary" data-i18n="tone_cancel_button">취소</button>
                <button id="toneConfirmBtn" class="btn btn-primary" data-i18n="tone_regenerate_button">새로운 톤으로 다시 생성</button>
            </div>
        </div>
    </div>

    <!-- API 설정 모달 -->
    <div id="apiSetupModal" class="modal">
        <div class="modal-content" style="width: 600px;">
            <h2 class="mb-3" data-i18n="api_setup_title">API 설정</h2>
            
            <!-- API 키 현재 상태 -->
            <div class="api-status mb-3">
                <div id="apiStatusConnected" class="status-card success hidden">
                    <div class="status-icon">✅</div>
                    <div class="status-info">
                        <div class="status-title" data-i18n="api_status_connected">연결됨</div>
                        <div class="status-desc" data-i18n="api_status_connected_desc">API 키가 정상적으로 설정되었습니다</div>
                    </div>
                </div>
                
                <div id="apiStatusDisconnected" class="status-card error">
                    <div class="status-icon">❌</div>
                    <div class="status-info">
                        <div class="status-title" data-i18n="api_status_disconnected">설정 필요</div>
                        <div class="status-desc" data-i18n="api_status_disconnected_desc">AI 블로그 생성을 위해 Gemini API 키가 필요합니다</div>
                    </div>
                </div>
            </div>

            <!-- API 키 입력 -->
            <div class="form-group">
                <label class="form-label" data-i18n="api_key_label">Gemini API 키</label>
                <div class="api-input-container">
                    <input type="password" id="apiKeyInput" class="form-input" placeholder="AIzaSy..." data-i18n-placeholder="api_key_placeholder">
                    <button type="button" id="toggleApiKey" class="btn btn-secondary btn-small">👁️</button>
                </div>
            </div>

            <!-- API 키 발급 가이드 -->
            <div class="api-guide mb-4">
                <h4 class="mb-2" data-i18n="api_guide_title">🔑 무료 API 키 발급받기</h4>
                
                <div class="guide-steps">
                    <div class="guide-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <strong data-i18n="api_guide_step1_title">Google AI Studio 접속</strong>
                            <p data-i18n="api_guide_step1_desc">아래 링크로 Google AI Studio에 접속합니다</p>
                            <a href="https://aistudio.google.com/app/apikey" target="_blank" class="guide-link">
                                🔗 aistudio.google.com/app/apikey
                            </a>
                        </div>
                    </div>
                    
                    <div class="guide-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <strong data-i18n="api_guide_step2_title">Google 계정으로 로그인</strong>
                            <p data-i18n="api_guide_step2_desc">Gmail 계정으로 로그인하세요</p>
                        </div>
                    </div>
                    
                    <div class="guide-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <strong data-i18n="api_guide_step3_title">"Create API Key" 클릭</strong>
                            <p data-i18n="api_guide_step3_desc">새로운 프로젝트를 선택하거나 기존 프로젝트를 선택합니다</p>
                        </div>
                    </div>
                    
                    <div class="guide-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <strong data-i18n="api_guide_step4_title">API 키 복사</strong>
                            <p data-i18n="api_guide_step4_desc">"AIzaSy..."로 시작하는 API 키를 복사하여 위 입력란에 붙여넣기</p>
                        </div>
                    </div>
                </div>

                <div class="api-info mt-3">
                    <div class="info-item">
                        <strong>💰 비용:</strong> <span data-i18n="api_cost_info">월 무료 한도 내에서 사용 가능</span>
                    </div>
                    <div class="info-item">
                        <strong>🔒 보안:</strong> <span data-i18n="api_security_info">API 키는 브라우저에만 저장되며 서버로 전송되지 않습니다</span>
                    </div>
                </div>
            </div>

            <div class="flex gap-2 justify-between">
                <button id="apiSetupCancelBtn" class="btn btn-secondary" data-i18n="api_setup_cancel">취소</button>
                <div class="flex gap-2">
                    <button id="apiTestBtn" class="btn btn-secondary" data-i18n="api_test_button">연결 테스트</button>
                    <button id="apiSaveBtn" class="btn btn-primary" data-i18n="api_save_button">저장</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 포스팅 강화 모달 -->
    <div id="enhanceModal" class="modal">
        <div class="modal-content" style="width: 900px;">
            <h2 class="mb-2" data-i18n="enhance_title">포스팅 강화하기</h2>
            <p class="mb-3" style="color: var(--text-secondary);" data-i18n="enhance_subtitle">입력한 카테고리와 주제로 인기 블로그 글을 분석하여 현재 글을 보완합니다.</p>
            
            <div id="enhanceProgress" class="hidden">
                <div class="progress-steps mb-4">
                    <div class="step active" id="step1">
                        <div class="step-number">1</div>
                        <div class="step-text">인기 포스팅 검색</div>
                    </div>
                    <div class="step" id="step2">
                        <div class="step-number">2</div>
                        <div class="step-text">내용 분석</div>
                    </div>
                    <div class="step" id="step3">
                        <div class="step-number">3</div>
                        <div class="step-text">부족한 내용 식별</div>
                    </div>
                    <div class="step" id="step4">
                        <div class="step-number">4</div>
                        <div class="step-text">포스팅 강화</div>
                    </div>
                </div>
                
                <div class="progress-content">
                    <div id="searchResults" class="mb-3">
                        <h4>📈 참조한 인기 포스팅:</h4>
                        <div id="referenceList"></div>
                    </div>
                    
                    <div id="analysisResults" class="mb-3 hidden">
                        <h4>🔍 분석 결과:</h4>
                        <div id="analysisContent"></div>
                    </div>
                    
                    <div id="enhancementPreview" class="hidden">
                        <h4>📝 추가/수정될 내용:</h4>
                        <div id="enhancementContent"></div>
                    </div>
                </div>
            </div>
            
            <div id="enhanceComparison" class="hidden">
                <div class="comparison-container">
                    <div class="comparison-section">
                        <h4>📄 수정 전</h4>
                        <div id="beforeContent" class="content-box"></div>
                    </div>
                    <div class="comparison-section">
                        <h4>✨ 수정 후</h4>
                        <div id="afterContent" class="content-box"></div>
                    </div>
                </div>
                
                <div class="enhancement-summary mt-3">
                    <h4>📊 강화 요약</h4>
                    <div id="enhancementSummary"></div>
                </div>
            </div>

            <div class="flex gap-2 justify-between mt-4">
                <button id="enhanceCancelBtn" class="btn btn-secondary" data-i18n="enhance_cancel_button">취소</button>
                <div class="flex gap-2">
                    <button id="enhanceStartBtn" class="btn btn-primary" data-i18n="enhance_start_button">강화 시작</button>
                    <button id="enhanceAcceptBtn" class="btn btn-success hidden" data-i18n="enhance_accept_button">강화 적용</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 전역 상태 관리
        let currentState = {
            apiKey: '',
            language: 'ko',
            theme: 'light',
            photos: [],
            generatedBlog: null,
            isLoading: false,
            editingImageIndex: null,
            isImageEditing: false,
            lastImageEditTime: 0,
            imageEditCount: 0
        };

        // 다국어 지원
        const translations = {
            ko: {
                app_title: 'AI 블로그 자동 생성기 - 사진만으로 완벽한 포스팅 작성',
                app_subtitle: '사진을 업로드하고, 세부 정보를 추가하면 AI가 전문적인 블로그 글을 자동으로 작성해 드립니다.',
                api_key_label: 'Gemini API 키',
                api_key_placeholder: 'AIzaSy... (Google AI Studio에서 받으세요)',
                api_key_help: 'Google AI Studio에서 무료로 API 키를 받을 수 있습니다.',
                form_category_label: '블로그 카테고리',
                form_category_placeholder: '예: 여행, 음식, 기술',
                form_topic_label: '주제 / 주요 아이디어',
                form_topic_placeholder: '예: 나의 놀라운 제주도 여행',
                form_photos_title: '사진 & 설명',
                form_upload_photo: '사진 업로드',
                form_photo_desc_placeholder: "이 사진을 설명해주세요 (예: '바다 위로 지는 아름다운 일몰')",
                form_add_photos_button: '사진 추가하기',
                form_review_prompt_button: '프롬프트 검토',
                review_title: '프롬프트 검토',
                review_subtitle: 'AI가 이 프롬프트를 사용하여 블로그 포스트를 생성합니다. 아래에서 수정하여 지침을 구체화할 수 있습니다.',
                review_word_count_label: '목표 글자 수',
                review_wc_option_1: '약 800자',
                review_wc_option_2: '약 1500자',
                review_wc_option_3: '약 2000자 (기본)',
                review_wc_option_4: '약 2500자 이상',
                review_wc_option_5: '직접 입력',
                review_back_button: '양식으로 돌아가기',
                review_confirm_button: '확인 & 생성',
                output_title: '생성된 블로그 포스트',
                output_add_modify_button: '콘텐츠 추가/수정',
                output_adjust_tone_button: '톤 조절',
                output_create_another_button: '다른 블로그 포스트 만들기',
                output_tab_preview: '미리보기',
                output_tab_html: 'HTML',
                output_tab_markdown: '마크다운',
                output_tab_text: '텍스트',
                output_copy_html: 'HTML 복사',
                output_copy_markdown: '마크다운 복사',
                output_copy_text: '텍스트 복사',
                output_addup_title: '블로그 포스트에 내용 추가하기',
                output_addup_instructions_label: '추가 지침',
                output_addup_instructions_placeholder: '예: 우리가 먹어본 현지 음식에 대한 섹션을 추가해줘. 결론을 더 낙관적으로 만들어줘.',
                output_addup_photos_title: '사진 더 추가하기',
                output_addup_add_photo_field_button: '사진 필드 추가',
                output_addup_cancel_button: '취소',
                output_addup_regenerate_button: '추가하여 다시 생성',
                tone_adjuster_title: '블로그 글 톤 조절하기',
                tone_formality: '격식',
                tone_enthusiasm: '열정',
                tone_confidence: '자신감',
                tone_humor: '유머',
                tone_clarity: '명확성',
                tone_cancel_button: '취소',
                tone_regenerate_button: '새로운 톤으로 다시 생성',
                // 포스팅 강화 관련 번역
                output_enhance_button: '포스팅 강화',
                enhance_title: '포스팅 강화하기',
                enhance_subtitle: '입력한 카테고리와 주제로 인기 블로그 글을 분석하여 현재 글을 보완합니다.',
                enhance_cancel_button: '취소',
                enhance_start_button: '강화 시작',
                enhance_accept_button: '강화 적용',
                enhance_no_content_error: '먼저 블로그 글을 생성해주세요.',
                // 이미지 수정 관련 번역
                edit_image_button: '이미지 수정',
                image_editor_title: '이미지 수정하기',
                image_editor_prompt_label: '수정 지시사항',
                image_editor_prompt_placeholder: '예: 배경을 파란 하늘로 바꿔줘, 사람을 제거해줘, 더 밝게 만들어줘 등',
                image_editor_cancel: '취소',
                image_editor_apply: '변경 적용',
                // API 설정 관련 번역
                api_setup_button: 'API',
                api_setup_title: 'API 설정',
                api_status_connected: '연결됨',
                api_status_connected_desc: 'API 키가 정상적으로 설정되었습니다',
                api_status_disconnected: '설정 필요',
                api_status_disconnected_desc: 'AI 블로그 생성을 위해 Gemini API 키가 필요합니다',
                api_guide_title: '🔑 무료 API 키 발급받기',
                api_guide_step1_title: 'Google AI Studio 접속',
                api_guide_step1_desc: '아래 링크로 Google AI Studio에 접속합니다',
                api_guide_step2_title: 'Google 계정으로 로그인',
                api_guide_step2_desc: 'Gmail 계정으로 로그인하세요',
                api_guide_step3_title: '"Create API Key" 클릭',
                api_guide_step3_desc: '새로운 프로젝트를 선택하거나 기존 프로젝트를 선택합니다',
                api_guide_step4_title: 'API 키 복사',
                api_guide_step4_desc: '"AIzaSy..."로 시작하는 API 키를 복사하여 위 입력란에 붙여넣기',
                api_cost_info: '월 무료 한도 내에서 사용 가능',
                api_security_info: 'API 키는 브라우저에만 저장되며 서버로 전송되지 않습니다',
                api_setup_cancel: '취소',
                api_test_button: '연결 테스트',
                api_save_button: '저장',
                error_api_key_required: 'Gemini API 키를 입력해주세요.',
                error_form_validation: '카테고리, 주제, 그리고 설명이 포함된 사진을 하나 이상 입력해주세요.',
                error_generation_failed: '블로그 생성에 실패했습니다. API 키를 확인하고 다시 시도해주세요.',
                success_copied: '복사되었습니다!',
                loading_message_1: "AI의 창의력을 예열 중...",
                loading_message_2: "아름다운 사진들을 분석 중...",
                loading_message_3: "흥미로운 이야기의 초안을 작성 중...",
                loading_message_4: "완벽한 단어들을 찾는 중...",
                loading_message_5: "마지막 문장들을 다듬는 중...",
                loading_message_6: "거의 다 왔어요, 마법이 일어나고 있습니다!"
            },
            en: {
                app_title: 'AI Blog Auto Generator - Perfect Posts with Just Photos',
                app_subtitle: 'Upload your photos, add some details, and our AI will automatically create professional blog posts for you.',
                api_key_label: 'Gemini API Key',
                api_key_placeholder: 'AIzaSy... (Get it from Google AI Studio)',
                api_key_help: 'You can get a free API key from Google AI Studio.',
                form_category_label: 'Blog Category',
                form_category_placeholder: 'e.g., Travel, Food, Technology',
                form_topic_label: 'Topic / Main Idea',
                form_topic_placeholder: 'e.g., My amazing trip to Jeju Island',
                form_photos_title: 'Photos & Descriptions',
                form_upload_photo: 'Upload Photo',
                form_photo_desc_placeholder: "Describe this photo (e.g., 'A beautiful sunset over the ocean')",
                form_add_photos_button: 'Add More Photos',
                form_review_prompt_button: 'Review Prompt',
                review_title: 'Review Your Prompt',
                review_subtitle: 'The AI will use this prompt to generate your blog post. You can edit it below to refine the instructions.',
                review_word_count_label: 'Target Word Count',
                review_wc_option_1: 'Approx. 800 words',
                review_wc_option_2: 'Approx. 1500 words',
                review_wc_option_3: 'Approx. 2000 words (Default)',
                review_wc_option_4: 'Approx. 2500+ words',
                review_wc_option_5: 'Custom',
                review_back_button: 'Back to Form',
                review_confirm_button: 'Confirm & Generate',
                output_title: 'Your Generated Blog Post',
                output_add_modify_button: 'Add/Modify Content',
                output_adjust_tone_button: 'Adjust Tone',
                output_create_another_button: 'Create Another Blog Post',
                output_tab_preview: 'Preview',
                output_tab_html: 'HTML',
                output_tab_markdown: 'Markdown',
                output_tab_text: 'Text',
                output_copy_html: 'Copy HTML',
                output_copy_markdown: 'Copy Markdown',
                output_copy_text: 'Copy Text',
                output_addup_title: 'Add to Your Blog Post',
                output_addup_instructions_label: 'Additional Instructions',
                output_addup_instructions_placeholder: 'e.g., Add a section about the local food we tried. Make the conclusion more optimistic.',
                output_addup_photos_title: 'Add More Photos',
                output_addup_add_photo_field_button: 'Add Photo Field',
                output_addup_cancel_button: 'Cancel',
                output_addup_regenerate_button: 'Regenerate with Additions',
                tone_adjuster_title: 'Adjust the Tone of Your Post',
                tone_formality: 'Formality',
                tone_enthusiasm: 'Enthusiasm',
                tone_confidence: 'Confidence',
                tone_humor: 'Humor',
                tone_clarity: 'Clarity',
                tone_cancel_button: 'Cancel',
                tone_regenerate_button: 'Regenerate with New Tone',
                // Post enhancement related translations
                output_enhance_button: 'Enhance Post',
                enhance_title: 'Enhance Your Post',
                enhance_subtitle: 'Analyze popular blog posts in your category and topic to improve your current content.',
                enhance_cancel_button: 'Cancel',
                enhance_start_button: 'Start Enhancement',
                enhance_accept_button: 'Apply Enhancement',
                enhance_no_content_error: 'Please generate a blog post first.',
                // Image editing related translations
                edit_image_button: 'Edit Image',
                image_editor_title: 'Edit Image',
                image_editor_prompt_label: 'Editing Instructions',
                image_editor_prompt_placeholder: 'e.g., Change the background to blue sky, remove the person, make it brighter, etc.',
                image_editor_cancel: 'Cancel',
                image_editor_apply: 'Apply Changes',
                // API Setup translations
                api_setup_button: 'API',
                api_setup_title: 'API Setup',
                api_status_connected: 'Connected',
                api_status_connected_desc: 'API key is configured successfully',
                api_status_disconnected: 'Setup Required',
                api_status_disconnected_desc: 'Gemini API key is required for AI blog generation',
                api_guide_title: '🔑 Get Free API Key',
                api_guide_step1_title: 'Visit Google AI Studio',
                api_guide_step1_desc: 'Go to Google AI Studio using the link below',
                api_guide_step2_title: 'Sign in with Google Account',
                api_guide_step2_desc: 'Log in with your Gmail account',
                api_guide_step3_title: 'Click "Create API Key"',
                api_guide_step3_desc: 'Select a new project or choose an existing project',
                api_guide_step4_title: 'Copy API Key',
                api_guide_step4_desc: 'Copy the API key starting with "AIzaSy..." and paste it in the input field above',
                api_cost_info: 'Available within monthly free quota',
                api_security_info: 'API key is stored only in your browser and not sent to our servers',
                api_setup_cancel: 'Cancel',
                api_test_button: 'Test Connection',
                api_save_button: 'Save',
                error_api_key_required: 'Please enter your Gemini API key.',
                error_form_validation: 'Please fill in the category, topic, and at least one photo with a description.',
                error_generation_failed: 'Failed to generate blog post. Please check your API key and try again.',
                success_copied: 'Copied!',
                loading_message_1: "Warming up the AI's creativity...",
                loading_message_2: "Analyzing your beautiful photos...",
                loading_message_3: "Drafting a compelling story...",
                loading_message_4: "Finding the perfect words...",
                loading_message_5: "Polishing the final sentences...",
                loading_message_6: "Almost there, the magic is happening!"
            }
        };

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            addInitialPhoto();
        });

        function initializeApp() {
            // 테마 초기화
            const savedTheme = localStorage.getItem('theme') || 'light';
            setTheme(savedTheme);
            
            // 언어 초기화
            updateLanguage(currentState.language);
            
            // API 키 초기화
            const savedApiKey = localStorage.getItem('gemini_api_key') || '';
            if (savedApiKey) {
                document.getElementById('apiKey').value = savedApiKey;
                currentState.apiKey = savedApiKey;
                updateApiStatus(savedApiKey);
            } else {
                updateApiStatus('');
            }
        }

        function setupEventListeners() {
            // 테마 토글
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            
            // 키보드 이벤트 (ESC로 모달 닫기)
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    // 이미지 에디터 모달이 열려있으면 닫기
                    if (document.getElementById('imageEditorModal').style.display !== 'none') {
                        closeImageEditor();
                        e.preventDefault();
                    }
                }
            });
            
            // 언어 선택
            document.getElementById('languageSelect').addEventListener('change', (e) => {
                updateLanguage(e.target.value);
            });

            // 사진 추가 버튼
            document.getElementById('addPhotoBtn').addEventListener('click', addPhotoField);

            // 프롬프트 검토 버튼
            document.getElementById('reviewBtn').addEventListener('click', openPromptReview);

            // 모달 이벤트들
            setupModalEvents();

            // 탭 이벤트들
            setupTabEvents();

            // 글자수 선택 이벤트
            document.getElementById('wordCountSelect').addEventListener('change', function() {
                const customInput = document.getElementById('customWordCount');
                if (this.value === 'custom') {
                    customInput.classList.remove('hidden');
                } else {
                    customInput.classList.add('hidden');
                }
            });
        }

        function setupModalEvents() {
            // 프롬프트 모달
            document.getElementById('promptBackBtn').addEventListener('click', () => {
                document.getElementById('promptModal').classList.remove('show');
            });
            document.getElementById('confirmGenerateBtn').addEventListener('click', generateBlogPost);

            // 콘텐츠 추가 모달
            document.getElementById('addContentBtn').addEventListener('click', openAddContentModal);
            document.getElementById('addContentCancelBtn').addEventListener('click', () => {
                document.getElementById('addContentModal').classList.remove('show');
            });
            document.getElementById('addContentConfirmBtn').addEventListener('click', addContentToBlog);
            document.getElementById('addMorePhotoBtn').addEventListener('click', addAdditionalPhoto);

            // 톤 조정 모달
            document.getElementById('adjustToneBtn').addEventListener('click', openToneModal);
            document.getElementById('toneCancelBtn').addEventListener('click', () => {
                document.getElementById('toneModal').classList.remove('show');
            });
            document.getElementById('toneConfirmBtn').addEventListener('click', adjustTone);

            // 다른 블로그 포스트 만들기
            document.getElementById('createAnotherBtn').addEventListener('click', resetApp);

            // 포스팅 강화 기능
            document.getElementById('enhancePostBtn').addEventListener('click', openEnhanceModal);
            document.getElementById('enhanceCancelBtn').addEventListener('click', closeEnhanceModal);
            document.getElementById('enhanceStartBtn').addEventListener('click', startEnhancement);
            document.getElementById('enhanceAcceptBtn').addEventListener('click', acceptEnhancement);

            // API 설정 기능
            document.getElementById('apiSetupBtn').addEventListener('click', openApiSetupModal);
            document.getElementById('apiSetupCancelBtn').addEventListener('click', closeApiSetupModal);
            document.getElementById('toggleApiKey').addEventListener('click', toggleApiKeyVisibility);
            document.getElementById('apiTestBtn').addEventListener('click', testApiConnection);
            document.getElementById('apiSaveBtn').addEventListener('click', saveApiKey);

            // 모달 배경 클릭으로 닫기
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('show');
                    }
                });
            });
        }

        function setupTabEvents() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    
                    // 모든 탭 비활성화
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                    
                    // 선택된 탭 활성화
                    tab.classList.add('active');
                    document.getElementById(tabName + 'Tab').classList.add('active');
                });
            });
        }

        function toggleTheme() {
            const newTheme = currentState.theme === 'light' ? 'dark' : 'light';
            setTheme(newTheme);
        }

        function setTheme(theme) {
            currentState.theme = theme;
            document.body.dataset.theme = theme;
            document.getElementById('themeToggle').textContent = theme === 'light' ? '🌙' : '☀️';
            localStorage.setItem('theme', theme);
        }

        function updateLanguage(lang) {
            currentState.language = lang;
            document.getElementById('languageSelect').value = lang;
            
            // 모든 다국어 요소 업데이트
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.dataset.i18n;
                if (translations[lang] && translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });

            // placeholder 업데이트
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.dataset.i18nPlaceholder;
                if (translations[lang] && translations[lang][key]) {
                    element.placeholder = translations[lang][key];
                }
            });
        }

        function t(key) {
            return translations[currentState.language][key] || key;
        }

        function addInitialPhoto() {
            addPhotoField();
        }

        function addPhotoField() {
            const container = document.getElementById('photoContainer');
            const photoId = Date.now();
            
            const photoDiv = document.createElement('div');
            photoDiv.className = 'photo-item';
            photoDiv.dataset.photoId = photoId;
            
            photoDiv.innerHTML = `
                <div class="photo-preview" onclick="document.getElementById('file-${photoId}').click()">
                    <div class="upload-placeholder">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <circle cx="8.5" cy="8.5" r="1.5"/>
                            <polyline points="21,15 16,10 5,21"/>
                        </svg>
                        <span>${t('form_upload_photo')}</span>
                    </div>
                    <input type="file" id="file-${photoId}" accept="image/*" style="display: none;" onchange="handlePhotoUpload(${photoId}, this)">
                </div>
                <div class="photo-content">
                    <textarea class="form-input form-textarea" placeholder="${t('form_photo_desc_placeholder')}" rows="3" onchange="updatePhotoDescription(${photoId}, this.value)"></textarea>
                    <button type="button" class="btn btn-error btn-small mt-2" onclick="removePhoto(${photoId})">
                        🗑️ 삭제
                    </button>
                </div>
            `;
            
            container.appendChild(photoDiv);
            
            // 사진 객체 초기화
            currentState.photos.push({
                id: photoId,
                file: null,
                description: '',
                base64: '',
                mimeType: ''
            });
        }

        function handlePhotoUpload(photoId, input) {
            const file = input.files[0];
            if (!file) return;

            const photoIndex = currentState.photos.findIndex(p => p.id === photoId);
            if (photoIndex === -1) return;

            // 미리보기 표시
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.querySelector(`[data-photo-id="${photoId}"] .photo-preview`);
                preview.innerHTML = `<img src="${e.target.result}" alt="Preview" style="width: 100%; height: 100%; object-fit: cover; border-radius: 6px;">`;
            };
            reader.readAsDataURL(file);

            // base64로 변환하여 저장
            const base64Reader = new FileReader();
            base64Reader.onload = function(e) {
                const base64String = e.target.result.split(',')[1];
                currentState.photos[photoIndex] = {
                    ...currentState.photos[photoIndex],
                    file: file,
                    base64: base64String,
                    mimeType: file.type
                };
            };
            base64Reader.readAsDataURL(file);
        }

        function updatePhotoDescription(photoId, description) {
            const photoIndex = currentState.photos.findIndex(p => p.id === photoId);
            if (photoIndex !== -1) {
                currentState.photos[photoIndex].description = description;
            }
        }

        function removePhoto(photoId) {
            // DOM에서 제거
            const photoElement = document.querySelector(`[data-photo-id="${photoId}"]`);
            photoElement.remove();
            
            // 상태에서 제거
            currentState.photos = currentState.photos.filter(p => p.id !== photoId);
        }

        function openPromptReview() {
            // 폼 검증
            const category = document.getElementById('category').value.trim();
            const topic = document.getElementById('topic').value.trim();
            const validPhotos = currentState.photos.filter(p => p.file && p.description.trim());

            if (!category || !topic || validPhotos.length === 0) {
                alert(t('error_form_validation'));
                return;
            }

            // 프롬프트 생성
            const prompt = generatePrompt(category, topic, validPhotos);
            document.getElementById('promptText').value = prompt;
            
            // 모달 표시
            document.getElementById('promptModal').classList.add('show');
        }

        function generatePrompt(category, topic, photos) {
            const photoDescriptions = photos.map((p, i) => `- Photo ${i + 1}: ${p.description}`).join('\n');
            
            if (currentState.language === 'ko') {
                return `# AI 블로그 포스트 생성 가이드라인

## 1. 목표 및 목적
블로그 글 작성은 고품질의 정보성 글을 작성하는 것을 목표로 합니다. 글은 독자에게 가치를 제공하고 독자의 관심을 끌 수 있는 내용으로 작성해야 합니다.

## 2. 글의 톤과 스타일
- 독자에게 친근하고, 접근하기 쉬운 언어를 사용해야 합니다.
- 간결하고 명료한 문장을 사용합니다.
- **가독성 최적화**: 대제목(#), 중제목(##), 소제목(###)을 사용하여 콘텐츠의 계층 구조를 명확하게 합니다.
- 중요한 키워드나 강조하고 싶은 문장은 **굵은 글씨**로 표시합니다.

## 3. 글의 구조
### 제목:
- 제목은 주제를 간결하고 매력적으로 요약합니다.
- **검색어 최적화(SEO)**를 고려하여 제목을 작성합니다.

### 본문:
- 세부 내용을 체계적으로 전개합니다.
- **중요**: 본문 내용 중 사진이 들어갈 가장 적절한 위치에 \`[IMAGE-1]\`, \`[IMAGE-2]\`와 같은 플레이스홀더를 반드시 삽입해주세요.
- 각 플레이스홀더는 제공된 사진 순서와 일치해야 합니다.

## 4. 글의 길이
- 이 블로그 글은 **약 2000자**로 작성해주세요.

---

**[생성 요청]**
위 가이드라인에 따라 아래 정보를 바탕으로 완전한 한국어 블로그 포스트를 생성해주세요. 최종 결과물은 JSON 형식으로 제공해주세요:

\`\`\`json
{
  "title": "매력적인 블로그 제목",
  "content": "마크다운 형식의 블로그 내용 (이미지 플레이스홀더 포함)",
  "image_captions": ["이미지 1 캡션", "이미지 2 캡션", ...]
}
\`\`\`

- **블로그 카테고리:** ${category}
- **주요 토픽/아이디어:** ${topic}
- **포함할 사진 및 설명 (순서대로 이미지 플레이스홀더를 본문에 삽입):**
${photoDescriptions}`;
            } else {
                return `# AI Blog Post Generation Guidelines

## 1. Goal and Objective
Write a high-quality, informative blog post that provides value to readers and captures their interest.

## 2. Tone and Style
- Use friendly and accessible language.
- Use concise and clear sentences.
- **Optimize for Readability**: Use main headings (#), subheadings (##), and minor headings (###) to create a clear content hierarchy.
- Emphasize important keywords using **bold text**.

## 3. Post Structure
### Title:
- The title should be a concise and appealing summary of the topic.
- Consider **Search Engine Optimization (SEO)**.

### Body:
- Develop the main content in a structured manner.
- **Important**: Insert placeholders like \`[IMAGE-1]\`, \`[IMAGE-2]\` at the most appropriate locations in the text.
- Each placeholder must correspond to the order of the provided photos.

## 4. Post Length
- Please write this blog post to be **approximately 2000 characters**.

---

**[Generation Request]**
Based on the guidelines above, please generate a complete blog post in English using the following information. Please provide the final output in JSON format:

\`\`\`json
{
  "title": "Engaging Blog Title",
  "content": "Blog content in Markdown format (with image placeholders)",
  "image_captions": ["Image 1 caption", "Image 2 caption", ...]
}
\`\`\`

- **Blog Category:** ${category}
- **Main Topic/Idea:** ${topic}
- **Photos and Descriptions to Include:**
${photoDescriptions}`;
            }
        }

        async function generateBlogPost() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                showError(t('error_api_key_required'));
                document.getElementById('apiKeySection').classList.add('error');
                return;
            }

            // API 키 저장 및 에러 상태 제거
            currentState.apiKey = apiKey;
            document.getElementById('apiKeySection').classList.remove('error');

            // 프롬프트 가져오기
            let prompt = document.getElementById('promptText').value.trim();
            
            // 글자수 설정 적용
            const wordCount = document.getElementById('wordCountSelect').value;
            const customCount = document.getElementById('customWordCount').value;
            
            if (wordCount === 'custom' && customCount) {
                if (currentState.language === 'ko') {
                    prompt = prompt.replace(/\*\*약 \d+자(\s이상)?\*\*/, `**약 ${customCount}자**`);
                } else {
                    prompt = prompt.replace(/\*\*approximately \d+ characters(\s or more)?\*\*/, `**approximately ${customCount} characters**`);
                }
            } else if (wordCount !== 'custom') {
                const suffix = wordCount === '2500' ? (currentState.language === 'ko' ? ' 이상' : ' or more') : '';
                if (currentState.language === 'ko') {
                    prompt = prompt.replace(/\*\*약 \d+자(\s이상)?\*\*/, `**약 ${wordCount}자${suffix}**`);
                } else {
                    prompt = prompt.replace(/\*\*approximately \d+ characters(\s or more)?\*\*/, `**approximately ${wordCount} characters${suffix}**`);
                }
            }

            // 모달 닫기 및 로딩 시작
            document.getElementById('promptModal').classList.remove('show');
            showLoading(true);

            try {
                const validPhotos = currentState.photos.filter(p => p.file && p.description.trim());
                const result = await callGeminiAPI(prompt, validPhotos);
                
                currentState.generatedBlog = result;
                showBlogOutput(result, validPhotos);
                showLoading(false);
                
            } catch (error) {
                console.error('Blog generation failed:', error);
                showError(t('error_generation_failed'));
                showLoading(false);
            }
        }

        async function callGeminiAPI(prompt, photos) {
            const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent';
            
            const imageParts = photos.map(photo => ({
                inlineData: {
                    data: photo.base64,
                    mimeType: photo.mimeType
                }
            }));

            const requestBody = {
                contents: [{
                    parts: [
                        { text: prompt },
                        ...imageParts
                    ]
                }],
                generationConfig: {
                    responseMimeType: "application/json",
                    temperature: 0.7,
                    responseSchema: {
                        type: "object",
                        properties: {
                            title: {
                                type: "string",
                                description: "A catchy and SEO-friendly title for the blog post."
                            },
                            content: {
                                type: "string",
                                description: "The full content of the blog post in Markdown format."
                            },
                            image_captions: {
                                type: "array",
                                items: {
                                    type: "string"
                                },
                                description: "An array of rewritten, engaging captions for each photo."
                            }
                        },
                        required: ["title", "content", "image_captions"]
                    }
                }
            };

            const response = await fetch(`${API_URL}?key=${currentState.apiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`API Error: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
            }

            const data = await response.json();
            const responseText = data.candidates?.[0]?.content?.parts?.[0]?.text;
            
            if (!responseText) {
                throw new Error('No response text from API');
            }

            // JSON 파싱
            let cleanedText = responseText.trim();
            const jsonMatch = cleanedText.match(/```(?:json)?\s*([\s\S]*?)\s*```/);
            if (jsonMatch) {
                cleanedText = jsonMatch[1];
            }

            try {
                const blogObject = JSON.parse(cleanedText);
                
                if (!blogObject.title || !blogObject.content || !Array.isArray(blogObject.image_captions)) {
                    throw new Error('Invalid response structure');
                }
                
                return blogObject;
            } catch (parseError) {
                console.error('JSON parsing failed:', cleanedText);
                throw new Error('Failed to parse API response');
            }
        }

        function showLoading(show) {
            currentState.isLoading = show;
            const loadingSection = document.getElementById('loadingSection');
            const blogForm = document.getElementById('blogForm');
            const blogOutput = document.getElementById('blogOutput');
            
            if (show) {
                loadingSection.classList.remove('hidden');
                blogForm.classList.add('hidden');
                blogOutput.classList.add('hidden');
                
                // 로딩 메시지 순환
                const messages = [
                    t('loading_message_1'),
                    t('loading_message_2'),
                    t('loading_message_3'),
                    t('loading_message_4'),
                    t('loading_message_5'),
                    t('loading_message_6')
                ];
                
                let messageIndex = 0;
                const messageElement = document.getElementById('loadingMessage');
                
                const updateMessage = () => {
                    messageElement.textContent = messages[messageIndex];
                    messageIndex = (messageIndex + 1) % messages.length;
                };
                
                updateMessage();
                currentState.loadingInterval = setInterval(updateMessage, 3000);
                
            } else {
                loadingSection.classList.add('hidden');
                if (currentState.loadingInterval) {
                    clearInterval(currentState.loadingInterval);
                }
            }
        }

        function showBlogOutput(blog, photos) {
            document.getElementById('blogForm').classList.add('hidden');
            document.getElementById('blogOutput').classList.remove('hidden');
            
            // 콘텐츠 생성
            const htmlContent = convertMarkdownToHtml(blog.content, blog.image_captions, photos);
            const textContent = convertMarkdownToText(blog.content);
            
            // 각 탭 콘텐츠 업데이트
            document.getElementById('blogPreview').innerHTML = htmlContent;
            document.getElementById('htmlContent').textContent = htmlContent;
            document.getElementById('markdownContent').textContent = blog.content;
            document.getElementById('textContent').textContent = textContent;
        }

        function convertMarkdownToHtml(markdown, captions, photos) {
            let html = markdown
                // 제목 변환
                .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                
                // 굵은 글씨
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                
                // 기울임
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                
                // 줄바꿈을 <p> 태그로
                .split('\n\n')
                .map(paragraph => {
                    if (paragraph.trim() && !paragraph.startsWith('<h') && !paragraph.includes('[IMAGE-')) {
                        return `<p>${paragraph.replace(/\n/g, '<br>')}</p>`;
                    }
                    return paragraph.replace(/\n/g, '<br>');
                })
                .join('\n');

            // 이미지 플레이스홀더 교체 (hover 시 수정 버튼 추가)
            for (let i = 0; i < photos.length; i++) {
                const imageTag = `<figure style="margin: 2rem 0; text-align: center; position: relative;" class="image-container group">
                    <div style="position: relative; display: inline-block;">
                        <img src="data:${photos[i].mimeType};base64,${photos[i].base64}" alt="${captions[i] || photos[i].description}" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);" class="blog-image" data-image-index="${i}">
                        <div class="image-overlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(45deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.1) 100%); border-radius: 8px; opacity: 0; transition: opacity 0.3s ease; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(2px);">
                            <button onclick="openImageEditor(${i})" class="edit-image-btn" style="display: flex; align-items: center; gap: 8px; padding: 12px 16px; background: rgba(255,255,255,0.9); color: #333; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; backdrop-filter: blur(10px); box-shadow: 0 4px 12px rgba(0,0,0,0.15);" data-i18n="edit_image_button">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="flex-shrink: 0;">
                                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                </svg>
                                이미지 수정
                            </button>
                        </div>
                    </div>
                    <figcaption style="margin-top: 0.5rem; color: var(--text-secondary); font-style: italic;">${captions[i] || photos[i].description}</figcaption>
                </figure>`;
                html = html.replace(`[IMAGE-${i + 1}]`, imageTag);
            }

            return html;
        }

        function convertMarkdownToText(markdown) {
            return markdown
                .replace(/^#{1,6}\s/gm, '')
                .replace(/\*\*(.*?)\*\*/g, '$1')
                .replace(/\*(.*?)\*/g, '$1')
                .replace(/\[IMAGE-\d+\]/g, '[이미지]')
                .replace(/\n{3,}/g, '\n\n')
                .trim();
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                // 성공 메시지 표시
                const button = element.parentElement.querySelector('button');
                const originalText = button.textContent;
                button.textContent = t('success_copied');
                
                setTimeout(() => {
                    button.innerHTML = `<span data-i18n="${elementId.replace('Content', '').replace(/^(.)/, (match) => `output_copy_${match.toLowerCase()}`)}"></span>`;
                    updateLanguage(currentState.language);
                }, 2000);
            }).catch(err => {
                console.error('복사 실패:', err);
            });
        }

        function openAddContentModal() {
            document.getElementById('addContentModal').classList.add('show');
            document.getElementById('additionalPhotos').innerHTML = '';
        }

        function addAdditionalPhoto() {
            const container = document.getElementById('additionalPhotos');
            const photoId = Date.now();
            
            const photoDiv = document.createElement('div');
            photoDiv.className = 'photo-item';
            photoDiv.dataset.additionalPhotoId = photoId;
            
            photoDiv.innerHTML = `
                <div class="photo-preview" onclick="document.getElementById('additional-file-${photoId}').click()">
                    <div class="upload-placeholder">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <circle cx="8.5" cy="8.5" r="1.5"/>
                            <polyline points="21,15 16,10 5,21"/>
                        </svg>
                        <span>${t('form_upload_photo')}</span>
                    </div>
                    <input type="file" id="additional-file-${photoId}" accept="image/*" style="display: none;" onchange="handleAdditionalPhotoUpload(${photoId}, this)">
                </div>
                <div class="photo-content">
                    <textarea class="form-input form-textarea" placeholder="${t('form_photo_desc_placeholder')}" rows="3"></textarea>
                    <button type="button" class="btn btn-error btn-small mt-2" onclick="removeAdditionalPhoto(${photoId})">
                        🗑️ 삭제
                    </button>
                </div>
            `;
            
            container.appendChild(photoDiv);
        }

        function handleAdditionalPhotoUpload(photoId, input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.querySelector(`[data-additional-photo-id="${photoId}"] .photo-preview`);
                preview.innerHTML = `<img src="${e.target.result}" alt="Preview" style="width: 100%; height: 100%; object-fit: cover; border-radius: 6px;">`;
            };
            reader.readAsDataURL(file);
        }

        function removeAdditionalPhoto(photoId) {
            const photoElement = document.querySelector(`[data-additional-photo-id="${photoId}"]`);
            photoElement.remove();
        }

        async function addContentToBlog() {
            // 프리미엄 기능 체크
            if (window.premiumUtils && !window.premiumUtils.checkFeature('advanced_editing')) {
                window.premiumUtils.showUpgrade();
                return;
            }

            // 사용량 체크
            if (window.premiumUtils && !window.premiumUtils.isPremium() && !window.premiumManager?.checkUsageLimits()) {
                if (window.premiumManager) {
                    window.premiumManager.showUsageLimitModal();
                }
                return;
            }

            const instructions = document.getElementById('addInstructions').value.trim();
            const additionalPhotoElements = document.querySelectorAll('[data-additional-photo-id]');
            
            // 추가 사진들 처리
            const additionalPhotos = [];
            for (let element of additionalPhotoElements) {
                const photoId = element.dataset.additionalPhotoId;
                const fileInput = document.getElementById(`additional-file-${photoId}`);
                const textarea = element.querySelector('textarea');
                
                if (fileInput.files[0] && textarea.value.trim()) {
                    const file = fileInput.files[0];
                    const base64 = await fileToBase64(file);
                    
                    additionalPhotos.push({
                        id: photoId,
                        file: file,
                        description: textarea.value.trim(),
                        base64: base64.split(',')[1],
                        mimeType: file.type
                    });
                }
            }

            if (!instructions && additionalPhotos.length === 0) {
                alert(t('output_addup_validation_error_empty'));
                return;
            }

            // 모든 사진 합치기 (기존 + 추가)
            const allPhotos = [...currentState.photos.filter(p => p.file), ...additionalPhotos];
            
            // 추가 프롬프트 생성
            const addUpPrompt = generateAddUpPrompt(instructions, currentState.generatedBlog, allPhotos);
            
            // 모달 닫기 및 로딩 시작
            document.getElementById('addContentModal').classList.remove('show');
            showLoading(true);

            try {
                const result = await callGeminiAPI(addUpPrompt, allPhotos);
                
                currentState.generatedBlog = result;
                currentState.photos = allPhotos; // 사진 목록 업데이트
                showBlogOutput(result, allPhotos);
                showLoading(false);
                
                // 사용량 증가
                if (window.premiumUtils) {
                    window.premiumUtils.incrementUsage('request');
                }
                
            } catch (error) {
                console.error('Add content failed:', error);
                showError(t('error_generation_failed'));
                showLoading(false);
            }
        }

        function generateAddUpPrompt(instructions, currentBlog, allPhotos) {
            const photoDescriptions = allPhotos.map((p, i) => `- Photo ${i + 1}: ${p.description}`).join('\n');
            
            if (currentState.language === 'ko') {
                return `# AI 블로그 포스트 수정 및 확장 가이드라인

## 1. 목표
기존에 작성된 블로그 포스트를 사용자의 추가 지침에 따라 수정하고 확장하는 것을 목표로 합니다. 기존 글의 톤, 스타일, 구조를 유지하면서 새로운 내용을 자연스럽게 통합해야 합니다.

## 2. 기존 블로그 포스트 내용
### 제목:
${currentBlog.title}

### 본문 (Markdown):
\`\`\`markdown
${currentBlog.content}
\`\`\`

## 3. 사용자 추가 요청사항
다음은 사용자가 요청한 수정 및 추가 내용입니다. 이 내용을 기존 블로그 포스트에 반영해주세요.
- **추가 지침:** ${instructions || "없음"}

## 4. 전체 사진 목록
수정된 블로그 포스트에는 아래의 모든 사진을 사용해야 합니다. 기존 사진과 새로 추가된 사진이 모두 포함되어 있습니다. 본문 내용에 맞게 각 사진의 위치를 재배치하고, 가장 적절한 곳에 \`[IMAGE-1]\`, \`[IMAGE-2]\`... 와 같은 플레이스홀더를 삽입해주세요.
- **사용할 사진 및 설명 (순서대로 이미지 플레이스홀더를 본문에 삽입):**
${photoDescriptions}

## 5. 최종 결과물 요구사항
- 기존 블로그 포스트의 내용과 새로운 요청사항을 완벽하게 통합하여 **하나의 완성된 새 블로그 포스트**를 생성해주세요.
- 최종 결과물은 JSON 형식으로 제공해주세요:

\`\`\`json
{
  "title": "수정된 블로그 제목",
  "content": "수정된 마크다운 형식의 블로그 내용",
  "image_captions": ["모든 이미지에 대한 캡션 배열"]
}
\`\`\`

---

**[수정 및 확장 요청]**
위 가이드라인과 정보를 바탕으로 완전한 한국어 블로그 포스트를 재생성해주세요.`;
            } else {
                return `# AI Blog Post Revision and Expansion Guidelines

## 1. Goal
The goal is to revise and expand a previously generated blog post based on the user's additional instructions. The new content should be seamlessly integrated while maintaining the original tone, style, and structure.

## 2. Existing Blog Post Content
### Title:
${currentBlog.title}

### Body (Markdown):
\`\`\`markdown
${currentBlog.content}
\`\`\`

## 3. User's Additional Requests
The following are the user's requested revisions and additions. Please incorporate these into the existing blog post.
- **Additional Instructions:** ${instructions || "None"}

## 4. Full List of Photos
The revised blog post must use all of the photos listed below, including both original and newly added ones. Please rearrange the placement of each photo as needed to fit the content, and insert placeholders like \`[IMAGE-1]\`, \`[IMAGE-2]\`... in the most appropriate locations.
- **Photos to Use (insert image placeholders in order):**
${photoDescriptions}

## 5. Final Output Requirements
- Perfectly integrate the existing blog post content with the new requests to generate **one complete, new blog post**.
- The final output must be in JSON format:

\`\`\`json
{
  "title": "Updated Blog Title",
  "content": "Updated blog content in Markdown format",
  "image_captions": ["Array of captions for all images"]
}
\`\`\`

---

**[Revision and Expansion Request]**
Based on the guidelines and information above, please regenerate a complete blog post in English.`;
            }
        }

        function openToneModal() {
            document.getElementById('toneModal').classList.add('show');
        }

        async function adjustTone() {
            // 프리미엄 기능 체크
            if (window.premiumUtils && !window.premiumUtils.checkFeature('advanced_editing')) {
                window.premiumUtils.showUpgrade();
                return;
            }

            // 사용량 체크
            if (window.premiumUtils && !window.premiumUtils.isPremium() && !window.premiumManager?.checkUsageLimits()) {
                if (window.premiumManager) {
                    window.premiumManager.showUsageLimitModal();
                }
                return;
            }

            const toneSettings = {
                formality: document.getElementById('toneFormality').value,
                enthusiasm: document.getElementById('toneEnthusiasm').value,
                confidence: document.getElementById('toneConfidence').value,
                humor: document.getElementById('toneHumor').value,
                clarity: document.getElementById('toneClarity').value
            };

            // 톤 조정 프롬프트 생성
            const allPhotos = currentState.photos.filter(p => p.file);
            const tonePrompt = generateToneAdjustPrompt(toneSettings, currentState.generatedBlog, allPhotos);
            
            // 모달 닫기 및 로딩 시작
            document.getElementById('toneModal').classList.remove('show');
            showLoading(true);

            try {
                const result = await callGeminiAPI(tonePrompt, allPhotos);
                
                currentState.generatedBlog = result;
                showBlogOutput(result, allPhotos);
                showLoading(false);
                
                // 사용량 증가
                if (window.premiumUtils) {
                    window.premiumUtils.incrementUsage('request');
                }
                
            } catch (error) {
                console.error('Tone adjustment failed:', error);
                showError(t('error_generation_failed'));
                showLoading(false);
            }
        }

        function generateToneAdjustPrompt(toneSettings, currentBlog, allPhotos) {
            const photoDescriptions = allPhotos.map((p, i) => `- Photo ${i + 1}: ${p.description}`).join('\n');
            
            if (currentState.language === 'ko') {
                return `# AI 블로그 포스트 톤 조절 가이드라인

## 1. 목표
기존에 작성된 블로그 포스트의 **톤과 스타일**을 사용자의 요구사항에 맞게 다시 작성하는 것을 목표로 합니다. 글의 핵심 내용, 구조, 그리고 사진 배치는 그대로 유지해야 합니다.

## 2. 기존 블로그 포스트 내용
### 제목:
${currentBlog.title}

### 본문 (Markdown):
\`\`\`markdown
${currentBlog.content}
\`\`\`

## 3. 새로운 톤 요구사항
아래의 톤 지표에 따라 글의 전체적인 분위기를 수정해주세요. 단어 선택, 문장 구조, 표현 방식 등을 조절하여 새로운 톤을 반영해야 합니다.

- **격식 (Formality):** ${toneSettings.formality}
- **열정 (Enthusiasm):** ${toneSettings.enthusiasm}
- **자신감 (Confidence):** ${toneSettings.confidence}
- **유머 (Humor):** ${toneSettings.humor}
- **명확성 (Clarity):** ${toneSettings.clarity}

## 4. 사진 목록
블로그 포스트에 사용된 사진 목록입니다. 톤을 조절할 때, 사진과 관련된 내용이 어색해지지 않도록 주의하고, **사진 캡션('image_captions')** 또한 새로운 톤에 맞게 자연스럽게 수정해주세요.
- **사용된 사진 및 설명:**
${photoDescriptions}

## 5. 최종 결과물 요구사항
- **핵심 내용과 구조는 변경하지 마세요.** 오직 글의 톤과 스타일만 수정해야 합니다.
- 본문 내의 이미지 플레이스홀더(\`[IMAGE-1]\` 등)는 원래 위치를 유지해야 합니다.
- 최종 결과물은 JSON 형식으로 제공해주세요:

\`\`\`json
{
  "title": "${currentBlog.title}",
  "content": "새로운 톤으로 수정된 마크다운 내용",
  "image_captions": ["새로운 톤에 맞는 이미지 캡션들"]
}
\`\`\`

---

**[톤 조절 재작성 요청]**
위 가이드라인과 새로운 톤 요구사항에 따라, 기존 블로그 포스트를 한국어로 다시 작성해주세요.`;
            } else {
                return `# AI Blog Post Tone Adjustment Guidelines

## 1. Goal
The primary goal is to rewrite an existing blog post to match new **tone and style** requirements provided by the user. The core content, structure, and photo placements must remain the same.

## 2. Existing Blog Post Content
### Title:
${currentBlog.title}

### Body (Markdown):
\`\`\`markdown
${currentBlog.content}
\`\`\`

## 3. New Tone Requirements
Please revise the overall feel of the post according to the following tone metrics. This should be reflected in word choice, sentence structure, and phrasing.

- **Formality:** ${toneSettings.formality}
- **Enthusiasm:** ${toneSettings.enthusiasm}
- **Confidence:** ${toneSettings.confidence}
- **Humor:** ${toneSettings.humor}
- **Clarity:** ${toneSettings.clarity}

## 4. Photo List
This is the list of photos used in the blog post. As you adjust the tone, ensure the content related to the photos remains relevant, and please **rewrite the photo captions ('image_captions')** to naturally fit the new tone.
- **Photos Used:**
${photoDescriptions}

## 5. Final Output Requirements
- **Do not change the core content or structure.** The rewrite should only affect the tone and style.
- Image placeholders (\`[IMAGE-1]\`, etc.) in the body must be preserved in their original locations.
- The final output must be in JSON format:

\`\`\`json
{
  "title": "${currentBlog.title}",
  "content": "Tone-adjusted markdown content",
  "image_captions": ["Tone-adjusted image captions"]
}
\`\`\`

---

**[Tone Adjustment Rewrite Request]**
Based on the guidelines and new tone requirements above, please rewrite the blog post in English.`;
            }
        }

        function resetApp() {
            // 상태 초기화
            currentState.generatedBlog = null;
            currentState.photos = [];
            
            // UI 초기화
            document.getElementById('blogForm').classList.remove('hidden');
            document.getElementById('blogOutput').classList.add('hidden');
            document.getElementById('category').value = '';
            document.getElementById('topic').value = '';
            document.getElementById('photoContainer').innerHTML = '';
            
            // 초기 사진 필드 추가
            addInitialPhoto();
        }

        // 포스팅 강화 기능들
        function openEnhanceModal() {
            if (!currentState.generatedBlog) {
                alert(t('enhance_no_content_error'));
                return;
            }
            
            // 모달 초기화
            resetEnhanceModal();
            document.getElementById('enhanceModal').classList.add('show');
        }

        function closeEnhanceModal() {
            document.getElementById('enhanceModal').classList.remove('show');
        }

        function resetEnhanceModal() {
            // 진행 상태 리셋
            document.querySelectorAll('.step').forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index === 0) step.classList.add('active');
            });
            
            // 컨텐츠 영역 숨기기
            document.getElementById('enhanceProgress').classList.add('hidden');
            document.getElementById('enhanceComparison').classList.add('hidden');
            
            // 버튼 상태 리셋
            document.getElementById('enhanceStartBtn').classList.remove('hidden');
            document.getElementById('enhanceAcceptBtn').classList.add('hidden');
            
            // 결과 초기화
            document.getElementById('referenceList').innerHTML = '';
            document.getElementById('analysisContent').innerHTML = '';
            document.getElementById('enhancementContent').innerHTML = '';
            document.getElementById('beforeContent').innerHTML = '';
            document.getElementById('afterContent').innerHTML = '';
            document.getElementById('enhancementSummary').innerHTML = '';
        }

        async function startEnhancement() {
            try {
                // 진행 화면 표시
                document.getElementById('enhanceProgress').classList.remove('hidden');
                document.getElementById('enhanceStartBtn').classList.add('hidden');
                
                const category = document.getElementById('category').value.trim();
                const topic = document.getElementById('topic').value.trim();
                
                if (!category || !topic) {
                    alert('카테고리와 주제를 입력해주세요.');
                    return;
                }

                // 1단계: 인기 포스팅 검색
                await updateStep(1, '인기 포스팅 검색 중...');
                const references = await searchPopularPosts(category, topic);
                displayReferences(references);
                completeStep(1);

                // 2단계: 내용 분석
                await updateStep(2, '참조 포스팅 분석 중...');
                const analysis = await analyzeContent(references, currentState.generatedBlog);
                displayAnalysis(analysis);
                completeStep(2);

                // 3단계: 부족한 내용 식별
                await updateStep(3, '부족한 내용 식별 중...');
                const gaps = await identifyContentGaps(analysis);
                displayContentGaps(gaps);
                completeStep(3);

                // 4단계: 포스팅 강화
                await updateStep(4, '포스팅 강화 중...');
                const enhancedContent = await enhanceContent(gaps, currentState.generatedBlog);
                displayEnhancement(enhancedContent);
                completeStep(4);

                // 비교 화면 표시
                document.getElementById('enhanceComparison').classList.remove('hidden');
                document.getElementById('enhanceAcceptBtn').classList.remove('hidden');

            } catch (error) {
                console.error('Enhancement error:', error);
                alert('포스팅 강화 중 오류가 발생했습니다: ' + error.message);
            }
        }

        async function updateStep(stepNumber, message) {
            const step = document.getElementById(`step${stepNumber}`);
            step.classList.add('active');
            step.querySelector('.step-text').textContent = message;
        }

        function completeStep(stepNumber) {
            const step = document.getElementById(`step${stepNumber}`);
            step.classList.remove('active');
            step.classList.add('completed');
        }

        async function searchPopularPosts(category, topic) {
            const searchQuery = `${category} ${topic} 블로그`;
            
            try {
                // 실제 웹 검색을 통한 인기 포스팅 수집
                // 여러 검색 엔진과 플랫폼에서 데이터 수집
                const searchResults = await Promise.allSettled([
                    searchNaverBlog(category, topic),
                    searchGooglePosts(category, topic),
                    searchWordPressPosts(category, topic)
                ]);
                
                const allResults = [];
                searchResults.forEach(result => {
                    if (result.status === 'fulfilled' && result.value) {
                        allResults.push(...result.value);
                    }
                });
                
                // 조회수와 공유수를 기준으로 상위 3개 선택
                const topPosts = allResults
                    .sort((a, b) => (b.views + b.shares * 10) - (a.views + a.shares * 10))
                    .slice(0, 3);
                
                if (topPosts.length > 0) {
                    return topPosts;
                }
            } catch (error) {
                console.warn('실제 검색 API 호출 실패, 시뮬레이션 데이터 사용:', error);
            }
            
            // 시뮬레이션 데이터 (실제 API 실패 시 대체)
            await new Promise(resolve => setTimeout(resolve, 1500));
            return [
                {
                    title: `${topic} 완벽 가이드: 초보자를 위한 단계별 설명`,
                    url: `https://blog.naver.com/example1/${topic.replace(/\s+/g, '')}`,
                    views: 15420,
                    shares: 342,
                    excerpt: `${topic}에 대한 상세한 설명과 실용적인 팁들을 제공하는 인기 포스팅입니다.`,
                    content: `${topic}은 매우 중요한 주제입니다. 이 글에서는 기본 개념부터 고급 활용법까지 단계별로 설명하겠습니다.`
                },
                {
                    title: `${category}의 새로운 트렌드: ${topic} 활용법`,
                    url: `https://tistory.com/example2/${topic.replace(/\s+/g, '')}`,
                    views: 12850,
                    shares: 298,
                    excerpt: `최신 트렌드를 반영한 ${topic} 활용 방법과 실제 사례를 소개합니다.`,
                    content: `${category} 분야에서 ${topic}이 어떻게 활용되고 있는지 실제 사례와 함께 알아보겠습니다.`
                },
                {
                    title: `전문가가 알려주는 ${topic} 노하우`,
                    url: `https://medium.com/example3/${topic.replace(/\s+/g, '')}`,
                    views: 8760,
                    shares: 156,
                    excerpt: `업계 전문가가 직접 공유하는 ${topic}에 대한 전문 지식과 경험담입니다.`,
                    content: `10년 경력의 전문가로서 ${topic}에 대해 꼭 알아야 할 핵심 포인트들을 정리했습니다.`
                }
            ];
        }

        // 네이버 블로그 검색 (실제 구현 시 네이버 검색 API 사용)
        async function searchNaverBlog(category, topic) {
            // 실제로는 네이버 검색 API 또는 크롤링을 통해 구현
            // 여기서는 시뮬레이션
            return null;
        }

        // Google Custom Search를 통한 블로그 포스팅 검색
        async function searchGooglePosts(category, topic) {
            // Google Custom Search API를 사용하여 구현
            // 실제 API 키가 필요하며, 여기서는 시뮬레이션
            return null;
        }

        // 워드프레스 블로그 검색
        async function searchWordPressPosts(category, topic) {
            // 워드프레스 REST API를 사용하여 구현
            // 여기서는 시뮬레이션
            return null;
        }

        function displayReferences(references) {
            const container = document.getElementById('referenceList');
            container.innerHTML = references.map(ref => `
                <div class="reference-item">
                    <div class="reference-title">${ref.title}</div>
                    <a href="${ref.url}" target="_blank" class="reference-link">
                        ${ref.url} 📎
                    </a>
                    <div class="reference-stats">
                        <span>조회수: ${ref.views.toLocaleString()}</span>
                        <span>공유: ${ref.shares.toLocaleString()}</span>
                    </div>
                    <p style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">
                        ${ref.excerpt}
                    </p>
                </div>
            `).join('');
            
            document.getElementById('searchResults').classList.remove('hidden');
        }

        async function analyzeContent(references, currentContent) {
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // AI를 사용하여 참조 포스팅과 현재 글을 비교 분석
            const prompt = `
다음 참조 포스팅들과 현재 작성된 블로그 글을 분석하여 비교해주세요.

참조 포스팅들:
${references.map(ref => `제목: ${ref.title}\n내용: ${ref.content}`).join('\n\n')}

현재 글:
${currentContent.content}

분석 결과를 JSON 형태로 제공해주세요:
{
    "commonTopics": ["공통으로 다루는 주제들"],
    "missingTopics": ["현재 글에서 누락된 중요 주제들"],
    "strengths": ["현재 글의 강점들"],
    "weaknesses": ["현재 글의 약점들"]
}
            `.trim();

            try {
                const response = await callGeminiAPI(prompt);
                return JSON.parse(response);
            } catch (error) {
                // 시뮬레이션 데이터
                return {
                    commonTopics: ["기본 개념", "실용적 활용법"],
                    missingTopics: ["최신 트렌드", "전문가 팁", "실제 사례", "주의사항"],
                    strengths: ["구조적 설명", "명확한 표현"],
                    weaknesses: ["깊이 부족", "실제 경험 부족", "최신 정보 부족"]
                };
            }
        }

        function displayAnalysis(analysis) {
            const container = document.getElementById('analysisContent');
            container.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <h5 style="color: var(--success-color); margin-bottom: 0.5rem;">✅ 현재 글의 강점</h5>
                    <ul style="margin-left: 1rem;">
                        ${analysis.strengths.map(strength => `<li>${strength}</li>`).join('')}
                    </ul>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <h5 style="color: var(--error-color); margin-bottom: 0.5rem;">❌ 개선이 필요한 부분</h5>
                    <ul style="margin-left: 1rem;">
                        ${analysis.weaknesses.map(weakness => `<li>${weakness}</li>`).join('')}
                    </ul>
                </div>
                
                <div>
                    <h5 style="color: var(--warning-color); margin-bottom: 0.5rem;">📝 추가하면 좋은 내용</h5>
                    <ul style="margin-left: 1rem;">
                        ${analysis.missingTopics.map(topic => `<li>${topic}</li>`).join('')}
                    </ul>
                </div>
            `;
            
            document.getElementById('analysisResults').classList.remove('hidden');
        }

        async function identifyContentGaps(analysis) {
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            return {
                gaps: analysis.missingTopics,
                recommendations: [
                    "최신 트렌드 정보 추가",
                    "실제 사례 및 경험담 포함",
                    "전문가 의견 및 팁 보강",
                    "주의사항 및 문제 해결 방법 추가"
                ]
            };
        }

        function displayContentGaps(gaps) {
            const container = document.getElementById('enhancementContent');
            container.innerHTML = `
                <div style="background: var(--warning-color); color: white; padding: 0.75rem; border-radius: 6px; margin-bottom: 1rem;">
                    <strong>📋 추가될 내용 미리보기</strong>
                </div>
                
                <div>
                    <h5 style="margin-bottom: 0.5rem;">🔧 개선 사항:</h5>
                    <ul style="margin-left: 1rem;">
                        ${gaps.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
            `;
            
            document.getElementById('enhancementPreview').classList.remove('hidden');
        }

        async function enhanceContent(gaps, originalContent) {
            await new Promise(resolve => setTimeout(resolve, 2500));
            
            const enhancePrompt = `
다음은 현재 작성된 블로그 글입니다:

${originalContent.content}

이 글을 개선하기 위해 다음 요소들을 자연스럽게 통합해주세요:
${gaps.recommendations.join('\n')}

중요한 조건:
1. 원본 글의 구조와 톤을 완전히 유지하세요
2. 기존 내용을 삭제하지 말고, 보완만 하세요
3. 작업 완료 메시지나 "추가된 내용" 같은 메타 정보는 절대 포함하지 마세요
4. 자연스럽고 일관된 흐름으로 내용을 확장하세요
5. 실제 정보와 구체적인 내용으로 보완하세요

다음 JSON 형태로 응답해주세요:
{
    "enhanced_content": "자연스럽게 강화된 전체 블로그 글 내용",
    "changes_made": ["구체적인 개선사항들"],
    "added_sections": ["보완된 내용 영역들"]
}
            `.trim();

            try {
                const response = await callGeminiAPI(enhancePrompt);
                const result = JSON.parse(response);
                
                return {
                    original: originalContent.content,
                    enhanced: result.enhanced_content,
                    changes: result.changes_made,
                    additions: result.added_sections
                };
            } catch (error) {
                console.error('Enhancement API error:', error);
                // 카테고리와 주제에 맞는 실제적인 보완 내용 생성
                const category = document.getElementById('category').value.trim();
                const topic = document.getElementById('topic').value.trim();
                const originalText = originalContent.content;
                
                // 카테고리별 맞춤형 보완 내용 생성
                const enhancements = getContextualEnhancements(category, topic, originalText);
                
                // 원본 텍스트는 그대로 유지하고, 마지막에만 실용적인 섹션 추가
                const enhancedText = originalText + enhancements.additionalSections;
                
                return {
                    original: originalContent.content,
                    enhanced: enhancedText,
                    changes: enhancements.changes,
                    additions: enhancements.additions
                };
            }
        }

        function getContextualEnhancements(category, topic, originalText) {
            // 원본 텍스트 분석을 통한 동적 카테고리 및 키워드 추출
            const content = (category + ' ' + topic + ' ' + originalText).toLowerCase();
            
            // 다양한 도메인 키워드 패턴 정의
            const domainPatterns = {
                travel: ['여행', 'travel', '발리', '태국', '일본', '호텔', '항공', '관광', '휴가', '배낭여행', '해외', '국내여행', '맛집', '명소', 'trip', 'vacation', 'tour'],
                food: ['음식', '요리', '맛집', '레시피', 'food', 'recipe', '셰프', '조리', '식당', '카페', '먹방', '디저트', '베이킹', '술', '와인', 'cooking', 'restaurant'],
                tech: ['기술', 'it', '개발', 'tech', '프로그래밍', '컴퓨터', '소프트웨어', '앱', '웹', 'ai', '인공지능', 'coding', 'programming', 'development'],
                health: ['건강', '운동', '피트니스', 'health', 'fitness', '다이어트', '요가', '헬스', '웰빙', '영양', 'workout', 'diet', 'wellness', '의학'],
                lifestyle: ['라이프스타일', 'lifestyle', '일상', '취미', '인테리어', '패션', 'fashion', '뷰티', 'beauty', '독서', '영화', '음악', 'hobby'],
                business: ['비즈니스', 'business', '창업', '투자', '경영', '마케팅', 'startup', 'investment', '부동산', '경제', 'finance', '자기계발'],
                education: ['교육', 'education', '학습', '공부', '학교', '대학', '자격증', '시험', 'study', 'learning', '강의', '튜토리얼'],
                art: ['예술', 'art', '그림', '사진', '디자인', 'design', '창작', '미술', '음악', 'music', '문학', 'photography', 'creative'],
                nature: ['자연', 'nature', '환경', '동물', '식물', '생태', '캠핑', 'camping', '등산', 'hiking', '바다', '산', '숲', 'outdoor'],
                family: ['가족', 'family', '육아', '아이', '부모', 'parenting', '결혼', 'marriage', '임신', '출산', '교육', 'kids', 'children']
            };
            
            // 도메인별 점수 계산
            let domainScores = {};
            for (const [domain, keywords] of Object.entries(domainPatterns)) {
                domainScores[domain] = keywords.filter(keyword => content.includes(keyword)).length;
            }
            
            // 가장 높은 점수의 도메인 선택 (동점일 경우 첫 번째 선택)
            const primaryDomain = Object.keys(domainScores).reduce((a, b) => 
                domainScores[a] >= domainScores[b] ? a : b
            );
            
            // 도메인별 맞춤형 강화 내용 생성
            return generateDomainSpecificEnhancements(primaryDomain, category, topic, originalText, domainScores);
        }

        function generateDomainSpecificEnhancements(domain, category, topic, originalText, scores) {
            // 도메인별 전문 강화 로직
            const enhancements = {
                travel: {
                    sections: generateTravelEnhancements(originalText, topic),
                    changes: ["현지 가이드 정보 추가", "여행객 후기 보강", "실용 여행 팁 포함", "현지 주의사항 가이드", "예산 및 교통편 정보"],
                    additions: ["여행 실용 팁", "현지 문화 정보", "안전 가이드", "예산 계획", "교통편 안내"]
                },
                food: {
                    sections: generateFoodEnhancements(originalText, topic),
                    changes: ["전문 셰프 조언 추가", "조리 기법 세부사항", "재료 선택 가이드", "안전 조리법", "보관 방법 정보"],
                    additions: ["전문 셰프 팁", "조리 안전 가이드", "재료 선택법", "보관 및 위생", "플레이팅 기법"]
                },
                tech: {
                    sections: generateTechEnhancements(originalText, topic),
                    changes: ["개발자 커뮤니티 정보", "최신 버전 기능", "실무 패턴 설명", "성능 최적화", "보안 모범 사례"],
                    additions: ["성능 최적화", "보안 가이드", "디버깅 전략", "코드 품질 관리", "테스팅 방법"]
                },
                health: {
                    sections: generateHealthEnhancements(originalText, topic),
                    changes: ["전문가 조언 추가", "안전 수칙 정보", "개인별 맞춤 가이드", "부상 예방법", "영양 관리 정보"],
                    additions: ["전문가 조언", "안전 수칙", "부상 예방", "영양 관리", "개인 맞춤 계획"]
                },
                lifestyle: {
                    sections: generateLifestyleEnhancements(originalText, topic),
                    changes: ["라이프스타일 전문가 팁", "실용적 활용법", "트렌드 정보", "개인 맞춤 가이드", "지속 가능한 방법"],
                    additions: ["전문가 팁", "실용 활용법", "최신 트렌드", "개인 맞춤", "지속 가능성"]
                },
                business: {
                    sections: generateBusinessEnhancements(originalText, topic),
                    changes: ["전문가 인사이트", "실무 경험 정보", "시장 분석 자료", "성공 사례", "위험 관리 방법"],
                    additions: ["전문가 인사이트", "실무 경험", "시장 분석", "성공 사례", "위험 관리"]
                },
                education: {
                    sections: generateEducationEnhancements(originalText, topic),
                    changes: ["교육 전문가 조언", "학습 효율 향상법", "실무 적용 방법", "평가 기준", "지속 학습 가이드"],
                    additions: ["전문가 조언", "효율 학습법", "실무 적용", "평가 방법", "지속 학습"]
                },
                art: {
                    sections: generateArtEnhancements(originalText, topic),
                    changes: ["예술가 관점 추가", "창작 기법 정보", "역사적 맥락", "감상 포인트", "실습 가이드"],
                    additions: ["예술가 관점", "창작 기법", "역사적 맥락", "감상법", "실습 방법"]
                },
                nature: {
                    sections: generateNatureEnhancements(originalText, topic),
                    changes: ["자연 전문가 정보", "환경 보호 방법", "관찰 포인트", "안전 수칙", "지속 가능성"],
                    additions: ["전문가 정보", "환경 보호", "관찰 포인트", "안전 수칙", "지속 가능성"]
                },
                family: {
                    sections: generateFamilyEnhancements(originalText, topic),
                    changes: ["육아 전문가 조언", "발달 단계별 가이드", "안전 관리법", "교육 방법", "가족 소통법"],
                    additions: ["전문가 조언", "발달 가이드", "안전 관리", "교육 방법", "소통법"]
                }
            };
            
            // 선택된 도메인의 강화 내용 반환, 없으면 범용 강화 내용
            const selectedEnhancement = enhancements[domain] || {
                sections: generateUniversalEnhancements(originalText, topic, category),
                changes: ["전문가 경험 정보", "실용 팁 추가", "단계별 접근법", "효과 극대화 방법", "지속 실천 가이드"],
                additions: ["전문가 팁", "실용 정보", "단계별 가이드", "효과 극대화", "지속 가능성"]
            };
            
            return {
                contextualInfo: [], // 원본 텍스트 수정 없음
                additionalSections: selectedEnhancement.sections,
                changes: selectedEnhancement.changes,
                additions: selectedEnhancement.additions,
                detectedDomain: domain,
                confidence: Math.max(...Object.values(scores)) / Math.max(1, Object.values(scores).reduce((a, b) => a + b, 0))
            };
        }

        // 스마트한 여행 컨텐츠 강화 함수
        function generateTravelEnhancements(originalText, topic) {
            const topicLower = topic.toLowerCase();
            const textLower = originalText.toLowerCase();
            
            let enhancements = [];
            
            // 텍스트 분석해서 관련된 실용 정보만 추가
            if (textLower.includes('서핑') || textLower.includes('surf')) {
                enhancements.push(`\n## 🏄‍♂️ 서핑 실용 가이드\n\n• **베스트 타이밍**: 오전 6-9시, 바람이 잔잔한 시간대\n• **장비 렌탈**: 보드 하루 150,000루피아 (~₩12,000)\n• **강습비**: 개인레슨 1시간 400,000루피아 (~₩32,000)\n• **초보 추천**: 울루와뚜 비치보다 더블식스 비치가 파도가 완만함`);
            }
            
            if (textLower.includes('카페') || textLower.includes('맛집') || textLower.includes('음식')) {
                enhancements.push(`\n## 🍽️ 맛집 & 카페 정보\n\n• **현지인 맛집**: 와룽 나시 아얌 이부 만구(Warung Nasi Ayam Ibu Mangku) - 나시아얌 35,000루피아\n• **서양식**: La Plancha 해변 클럽 - 평균 1인 250,000루피아\n• **카페 추천**: Deus Ex Machina, The Shady Shack (비건 메뉴 유명)\n• **현지 디저트**: 에스 캄퐁(Es Campur) - 전통 팥빙수 25,000루피아`);
            }
            
            if (textLower.includes('숙소') || textLower.includes('호텔') || textLower.includes('빌라')) {
                enhancements.push(`\n## 🏨 숙박 팁\n\n• **가성비 호스텔**: 1박 15-30만원대 (에어컨, 수영장 포함)\n• **중급 호텔**: 1박 50-80만원대 (조식 포함, 해변 접근 용이)\n• **럭셔리 빌라**: 1박 150-300만원대 (전용 수영장, 24시간 서비스)\n• **예약 팁**: 현지 도착 후 직접 예약하면 30% 할인 가능`);
            }
            
            // 기본적인 실용 정보는 항상 포함
            enhancements.push(`\n## 💡 필수 여행 정보\n\n• **교통비**: 공항-짱구 택시 250,000루피아 (~₩20,000), 그랩 이용 추천\n• **현지 교통**: 스쿠터 렌탈 하루 70,000루피아 (~₩5,600), 국제면허 필수\n• **환전**: 1만원 = 약 120,000루피아 (2024년 기준)\n• **팁 문화**: 레스토랑 10%, 마사지 20,000루피아, 택시 반올림`);
            
            enhancements.push(`\n## ⚠️ 주의사항\n\n• **성수기**: 7-8월, 12월-1월 (숙박비 2배, 미리 예약 필수)\n• **우기**: 11월-3월 (오후 스콜 빈번, 우산 필수)\n• **안전**: 해변 밤늦은 시간 혼자 다니기 금지\n• **협상**: 관광지 가격은 협상 가능 (특히 아트마켓, 기념품점)`);
            
            return enhancements.join('');
        }

        // 스마트한 요리 컨텐츠 강화 함수  
        function generateFoodEnhancements(originalText, topic) {
            const textLower = originalText.toLowerCase();
            let enhancements = [];
            
            if (textLower.includes('재료') || textLower.includes('ingredient')) {
                enhancements.push(`\n## 🛒 재료 선택 가이드\n\n• **신선도 체크**: 육류는 탄력성, 채소는 색깔과 수분감 확인\n• **대체재료**: 품절 시 사용 가능한 대안 재료 목록\n• **보관법**: 재료별 최적 보관 온도와 기간\n• **구매 팁**: 대형마트 vs 전통시장 가격 비교`);
            }
            
            if (textLower.includes('조리') || textLower.includes('요리') || textLower.includes('만들기')) {
                enhancements.push(`\n## 👨‍🍳 조리 핵심 기법\n\n• **화력 조절**: 센 불-중 불-약불 전환 타이밍\n• **간 맞추기**: 조리 중간중간 맛보며 단계별 간 조절\n• **텍스처**: 음식별 최적 식감을 위한 조리 시간\n• **플레이팅**: 색깔 배치와 고명으로 비주얼 완성`);
            }
            
            enhancements.push(`\n## 💡 실패 방지 팁\n\n• **흔한 실수**: 과도한 간, 너무 센 불 사용, 재료 투입 순서 오류\n• **응급처치**: 너무 짜거나 매울 때 대처법\n• **시간 관리**: 동시 조리를 위한 준비 순서\n• **도구 활용**: 기본 조리도구 200% 활용법`);
            
            return enhancements.join('');
        }

        // 스마트한 기술 컨텐츠 강화 함수
        function generateTechEnhancements(originalText, topic) {
            const textLower = originalText.toLowerCase();
            let enhancements = [];
            
            if (textLower.includes('코드') || textLower.includes('프로그래밍')) {
                enhancements.push(`\n## 💻 실무 코드 예시\n\n• **에러 처리**: try-catch 블록 활용한 안정적인 코드\n• **성능 최적화**: 메모리 사용량 줄이는 구체적 기법\n• **코드 리뷰**: 팀 협업을 위한 가독성 개선\n• **테스트**: 단위 테스트 작성으로 버그 사전 방지`);
            }
            
            enhancements.push(`\n## 🔧 실무 적용 가이드\n\n• **버전 관리**: Git 활용한 효율적인 협업 방법\n• **디버깅**: 단계별 문제 해결 프로세스\n• **문서화**: 코드 의도 명확히 전달하는 주석 작성법\n• **배포**: 실제 서비스 환경 고려사항`);
            
            return enhancements.join('');
        }

        function generateHealthEnhancements(originalText, topic) {
            const textLower = originalText.toLowerCase();
            let enhancements = [];
            
            if (textLower.includes('운동') || textLower.includes('exercise')) {
                enhancements.push(`\n## 💪 전문 트레이너 조언\n\n• **올바른 자세**: 부상 예방과 효과 극대화를 위한 정확한 폼\n• **운동 강도**: 개인 체력에 맞는 적절한 강도 설정법\n• **휴식의 중요성**: 근육 회복과 성장을 위한 휴식 계획\n• **영양 관리**: 운동 효과를 높이는 식단 가이드`);
            }
            
            enhancements.push(`\n## ⚠️ 안전 수칙 & 주의사항\n\n• **부상 예방**: 운동 전후 스트레칭과 워밍업의 중요성\n• **과도한 운동 위험**: 오버트레이닝 증상과 예방법\n• **건강 상태 체크**: 운동 시작 전 확인해야 할 건강 지표\n• **전문의 상담**: 기존 질환이 있는 경우 주의사항`);
            
            return enhancements.join('');
        }

        function generateLifestyleEnhancements(originalText, topic) {
            const textLower = originalText.toLowerCase();
            let enhancements = [];
            
            if (textLower.includes('인테리어') || textLower.includes('interior')) {
                enhancements.push(`\n## 🏠 인테리어 전문가 팁\n\n• **공간 활용**: 작은 공간을 넓어 보이게 하는 배치법\n• **컬러 매칭**: 조화로운 색상 조합으로 분위기 연출\n• **조명 활용**: 자연광과 인공조명의 균형잡힌 활용\n• **예산 관리**: 비용 대비 효과적인 인테리어 우선순위`);
            } else if (textLower.includes('패션') || textLower.includes('fashion')) {
                enhancements.push(`\n## 👗 패션 스타일리스트 조언\n\n• **체형별 스타일링**: 개인 체형에 맞는 옷 선택법\n• **컬러 매칭**: 피부톤에 어울리는 색상 찾기\n• **트렌드 활용**: 유행을 개성에 맞게 적용하는 방법\n• **예산 관리**: 합리적 가격으로 스타일 완성하기`);
            }
            
            enhancements.push(`\n## ✨ 라이프스타일 향상 팁\n\n• **지속 가능한 습관**: 오래 유지할 수 있는 실천 방법\n• **개인 맞춤**: 자신의 라이프스타일에 맞는 적용법\n• **효율성 극대화**: 시간과 비용을 절약하는 스마트한 방법\n• **만족도 향상**: 작은 변화로 큰 만족감 얻기`);
            
            return enhancements.join('');
        }

        function generateBusinessEnhancements(originalText, topic) {
            const textLower = originalText.toLowerCase();
            let enhancements = [];
            
            if (textLower.includes('창업') || textLower.includes('startup')) {
                enhancements.push(`\n## 🚀 창업 전문가 인사이트\n\n• **시장 검증**: 아이디어의 시장성 확인하는 구체적 방법\n• **자금 조달**: 초기 자본 확보를 위한 다양한 경로\n• **팀 구성**: 성공적인 스타트업을 위한 핵심 인재 영입\n• **위험 관리**: 창업 과정에서 마주할 수 있는 리스크 대비`);
            } else if (textLower.includes('투자') || textLower.includes('investment')) {
                enhancements.push(`\n## 📈 투자 전문가 조언\n\n• **리스크 관리**: 포트폴리오 다양화를 통한 위험 분산\n• **시장 분석**: 투자 대상의 펀더멘털 분석법\n• **타이밍**: 시장 사이클에 따른 투자 전략\n• **세금 효율**: 투자 수익에 대한 세금 최적화 방법`);
            }
            
            enhancements.push(`\n## 💼 실무 경험 & 노하우\n\n• **네트워킹**: 효과적인 인맥 구축과 관계 유지법\n• **성과 측정**: KPI 설정과 성과 분석 방법론\n• **지속 성장**: 안정적이고 지속적인 성장 전략\n• **위기 대응**: 예상치 못한 상황에서의 대처 방안`);
            
            return enhancements.join('');
        }

        function generateEducationEnhancements(originalText, topic) {
            const textLower = originalText.toLowerCase();
            let enhancements = [];
            
            if (textLower.includes('학습') || textLower.includes('study')) {
                enhancements.push(`\n## 📚 학습 효율 극대화 방법\n\n• **기억법**: 장기 기억으로 저장하는 효과적인 학습 기법\n• **집중력 향상**: 주의력 분산 없이 몰입하는 환경 조성법\n• **복습 전략**: 에빙하우스 망각 곡선을 활용한 반복 학습\n• **실무 적용**: 배운 내용을 실제 업무에 적용하는 방법`);
            }
            
            enhancements.push(`\n## 🎯 교육 전문가 가이드\n\n• **개인별 학습 스타일**: 시각적, 청각적, 체험적 학습법 활용\n• **목표 설정**: SMART 기법으로 구체적인 학습 목표 수립\n• **평가와 피드백**: 학습 진도 체크와 개선점 파악\n• **지속 학습**: 평생 학습을 위한 동기 부여와 습관 형성`);
            
            return enhancements.join('');
        }

        function generateArtEnhancements(originalText, topic) {
            const textLower = originalText.toLowerCase();
            let enhancements = [];
            
            if (textLower.includes('그림') || textLower.includes('painting')) {
                enhancements.push(`\n## 🎨 예술가 창작 기법\n\n• **표현 기법**: 다양한 매체와 도구의 특성 활용법\n• **구도와 색감**: 시각적 균형과 감정 표현을 위한 색상 이론\n• **창작 과정**: 아이디어 발상부터 완성까지의 체계적 접근\n• **개성 개발**: 자신만의 독특한 스타일 찾고 발전시키기`);
            } else if (textLower.includes('사진') || textLower.includes('photography')) {
                enhancements.push(`\n## 📸 사진작가 전문 팁\n\n• **구도와 앵글**: 피사체를 돋보이게 하는 촬영 구도법\n• **빛과 그림자**: 자연광과 인공조명 활용한 분위기 연출\n• **후보정 기술**: 사진의 완성도를 높이는 편집 노하우\n• **장비 활용**: 카메라와 렌즈 특성을 살린 촬영법`);
            }
            
            enhancements.push(`\n## 🌟 예술 감상과 비평\n\n• **작품 분석**: 예술 작품의 의도와 메시지 해석법\n• **역사적 맥락**: 시대적 배경과 예술사적 의미 이해\n• **개인적 감상**: 주관적 감상을 객관적으로 표현하는 방법\n• **창작 영감**: 다른 작품에서 영감을 얻는 효과적인 방법`);
            
            return enhancements.join('');
        }

        function generateNatureEnhancements(originalText, topic) {
            const textLower = originalText.toLowerCase();
            let enhancements = [];
            
            if (textLower.includes('등산') || textLower.includes('hiking')) {
                enhancements.push(`\n## 🏔️ 등산 전문가 가이드\n\n• **코스 선택**: 체력과 경험에 맞는 안전한 등산로 선별\n• **장비 준비**: 계절과 코스별 필수 장비 체크리스트\n• **안전 수칙**: 산행 중 응급상황 대처법과 예방법\n• **자연 보호**: 등산객이 지켜야 할 환경 보호 원칙`);
            } else if (textLower.includes('캠핑') || textLower.includes('camping')) {
                enhancements.push(`\n## 🏕️ 캠핑 마스터 노하우\n\n• **캠핑장 선택**: 초보자부터 숙련자까지 적합한 캠핑지 추천\n• **텐트 설치**: 날씨와 지형을 고려한 안전한 설치법\n• **캠핑 요리**: 야외에서 쉽고 맛있게 만들 수 있는 요리법\n• **자연과의 공존**: Leave No Trace 원칙 실천법`);
            }
            
            enhancements.push(`\n## 🌿 자연 관찰과 보호\n\n• **생태 관찰**: 동식물 관찰 시 지켜야 할 예의와 방법\n• **환경 보호**: 개인이 실천할 수 있는 구체적인 환경 보호 활동\n• **계절별 특성**: 사계절 자연의 변화와 관찰 포인트\n• **지속 가능성**: 자연을 보호하면서 즐기는 현명한 방법`);
            
            return enhancements.join('');
        }

        function generateFamilyEnhancements(originalText, topic) {
            const textLower = originalText.toLowerCase();
            let enhancements = [];
            
            if (textLower.includes('육아') || textLower.includes('parenting')) {
                enhancements.push(`\n## 👶 육아 전문가 조언\n\n• **발달 단계별 특성**: 월령별 아이의 발달 특징과 적절한 자극\n• **양육 스킬**: 아이와의 효과적인 소통과 훈육 방법\n• **영양 관리**: 성장기 아이에게 필요한 균형 잡힌 식단\n• **안전 관리**: 가정 내 아이 안전사고 예방법`);
            } else if (textLower.includes('교육') || textLower.includes('education')) {
                enhancements.push(`\n## 📖 가정 교육 가이드\n\n• **학습 동기**: 아이의 학습 의욕을 높이는 격려 방법\n• **창의성 개발**: 놀이를 통한 창의적 사고력 증진법\n• **독서 습관**: 책 읽기를 좋아하는 아이로 키우는 방법\n• **진로 지도**: 아이의 적성과 흥미 발견하고 지원하기`);
            }
            
            enhancements.push(`\n## 💕 가족 관계 증진법\n\n• **소통의 기술**: 가족 구성원 간 건강한 의사소통 방법\n• **갈등 해결**: 가정 내 갈등을 현명하게 해결하는 노하우\n• **추억 만들기**: 가족만의 특별한 추억을 만드는 활동들\n• **워라밸**: 일과 가정의 균형 잡힌 생활 관리법`);
            
            return enhancements.join('');
        }

        function generateUniversalEnhancements(originalText, topic, category) {
            // 내용이 특정 도메인에 속하지 않거나 분류가 애매할 때 사용하는 범용 강화
            const textLower = originalText.toLowerCase();
            let enhancements = [];
            
            // 키워드 기반 동적 섹션 생성
            const hasSteps = textLower.includes('방법') || textLower.includes('단계') || textLower.includes('how');
            const hasTips = textLower.includes('팁') || textLower.includes('노하우') || textLower.includes('tip');
            const hasWarning = textLower.includes('주의') || textLower.includes('위험') || textLower.includes('조심');
            
            if (hasSteps) {
                enhancements.push(`\n## 📋 단계별 실행 가이드\n\n• **체계적 접근**: 순서대로 따라하면 성공할 수 있는 구체적 단계\n• **준비사항**: 시작하기 전에 미리 준비해야 할 것들\n• **체크포인트**: 각 단계에서 확인해야 할 중요 사항들\n• **문제 해결**: 진행 중 막혔을 때 대처 방법`);
            }
            
            if (hasTips) {
                enhancements.push(`\n## 💡 전문가 실용 팁\n\n• **효율성 증대**: 시간과 노력을 절약하는 스마트한 방법\n• **품질 향상**: 더 나은 결과를 얻기 위한 세부 기법들\n• **비용 절약**: 합리적인 비용으로 목표 달성하는 노하우\n• **지속 가능성**: 꾸준히 실천할 수 있는 현실적 방법`);
            }
            
            if (hasWarning) {
                enhancements.push(`\n## ⚠️ 주의사항 & 안전 가이드\n\n• **위험 요소**: 미리 알아두어야 할 잠재적 위험들\n• **예방 조치**: 문제 발생을 미연에 방지하는 방법\n• **대처 방안**: 예상치 못한 상황 발생 시 대응법\n• **전문가 상담**: 도움이 필요한 경우 문의할 곳`);
            }
            
            // 기본 범용 섹션 (항상 포함)
            enhancements.push(`\n## 🎯 핵심 포인트 요약\n\n• **성공 요인**: 목표 달성을 위한 가장 중요한 요소들\n• **개인 맞춤**: 각자의 상황에 맞게 조정하는 방법\n• **지속적 개선**: 더 나은 결과를 위한 점검과 개선 사항\n• **확장 활용**: 이 경험을 다른 분야에 응용하는 방법`);
            
            return enhancements.join('');
        }

        // 이미지 수정 관련 함수들
        function openImageEditor(imageIndex) {
            const photo = currentState.photos[imageIndex];
            if (!photo) {
                alert('이미지를 찾을 수 없습니다.');
                return;
            }

            currentState.editingImageIndex = imageIndex;
            
            // 모달에 이미지 표시
            const imageElement = document.getElementById('editingImage');
            imageElement.src = `data:${photo.mimeType};base64,${photo.base64}`;
            
            // 프롬프트 초기화
            document.getElementById('imageEditPrompt').value = '';
            
            // 모달 표시
            document.getElementById('imageEditorModal').style.display = 'flex';
            
            // 스크롤 비활성화
            document.body.style.overflow = 'hidden';
        }

        function closeImageEditor() {
            document.getElementById('imageEditorModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            currentState.editingImageIndex = null;
            currentState.isImageEditing = false;
            
            // 로딩 상태 숨기기
            document.getElementById('imageEditingLoader').style.display = 'none';
        }

        async function confirmImageEdit() {
            const prompt = document.getElementById('imageEditPrompt').value.trim();
            if (!prompt) {
                alert('수정 지시사항을 입력해주세요.');
                return;
            }

            if (currentState.editingImageIndex === null) {
                alert('수정할 이미지를 선택해주세요.');
                return;
            }

            if (!currentState.apiKey) {
                alert('API 키가 설정되지 않았습니다. 먼저 API 키를 설정해주세요.');
                return;
            }

            // 사용량 제한 체크
            const currentTime = Date.now();
            const timeSinceLastEdit = currentTime - currentState.lastImageEditTime;
            
            // 1분 내에 5회 이상 사용 시 경고
            if (timeSinceLastEdit < 60000 && currentState.imageEditCount >= 5) {
                const remainingTime = Math.ceil((60000 - timeSinceLastEdit) / 1000);
                if (!confirm(`⚠️ 잠시만요! 너무 많은 요청을 보냈습니다.\n\n• ${remainingTime}초 후에 다시 시도하시거나\n• 계속하시면 API 한도 초과 위험이 있습니다\n\n그래도 계속 하시겠습니까?`)) {
                    return;
                }
            }

            // 30초 내 재시도 시 경고
            if (timeSinceLastEdit < 30000 && currentState.imageEditCount > 0) {
                const remainingTime = Math.ceil((30000 - timeSinceLastEdit) / 1000);
                showNotification(`💡 API 효율성을 위해 ${remainingTime}초 더 기다리시는 것을 권장합니다.`, 'info');
            }

            try {
                // 로딩 시작
                currentState.isImageEditing = true;
                document.getElementById('imageEditingLoader').style.display = 'flex';
                
                const originalPhoto = currentState.photos[currentState.editingImageIndex];
                
                // 사용량 추적 업데이트
                const currentTime = Date.now();
                if (currentTime - currentState.lastImageEditTime > 60000) {
                    // 1분이 지나면 카운터 리셋
                    currentState.imageEditCount = 0;
                }
                currentState.lastImageEditTime = currentTime;
                currentState.imageEditCount++;
                
                const newBase64 = await editBlogPostImage(originalPhoto, prompt);
                
                // 이미지 업데이트
                currentState.photos[currentState.editingImageIndex].base64 = newBase64;
                
                // 모달 닫기
                closeImageEditor();
                
                // 성공 알림
                showNotification('이미지가 성공적으로 수정되었습니다!', 'success');
                
                // API 상태 업데이트 (사용량 표시 갱신)
                updateApiStatus(currentState.apiKey);
                
                // 블로그 재표시 (이미지가 업데이트됨)
                if (currentState.generatedBlog) {
                    showBlogOutput(currentState.generatedBlog);
                }
                
            } catch (error) {
                console.error('Image editing error:', error);
                showNotification(error.message || '이미지 수정 중 오류가 발생했습니다.', 'error');
            } finally {
                // 로딩 종료
                currentState.isImageEditing = false;
                document.getElementById('imageEditingLoader').style.display = 'none';
            }
        }

        async function editBlogPostImage(originalPhoto, prompt) {
            if (!currentState.apiKey) {
                throw new Error('API 키가 설정되지 않았습니다.');
            }

            const requestBody = {
                contents: [{
                    parts: [
                        {
                            inline_data: {
                                mime_type: originalPhoto.mimeType,
                                data: originalPhoto.base64
                            }
                        },
                        {
                            text: `Edit this image: ${prompt}. Please modify the image according to the instruction while keeping the overall composition and style consistent.`
                        }
                    ]
                }]
            };

            try {
                // nano banana 모델(gemini-2.5-flash-image-preview) 사용
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${currentState.apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    const statusCode = response.status;
                    const errorMessage = errorData.error?.message || '알 수 없는 오류';
                    
                    // 구체적인 에러 메시지 제공
                    if (statusCode === 400 && errorMessage.includes('model not found')) {
                        throw new Error('⚠️ 현재 API 키로는 이미지 편집 모델(gemini-2.5-flash-image-preview)에 접근할 수 없습니다.\n\n• Google AI Studio에서 이미지 생성 기능이 활성화된 API 키를 사용해주세요.\n• 또는 대기 목록에서 액세스 권한을 요청하세요.');
                    }
                    
                    if (statusCode === 429) {
                        throw new Error('📊 API 호출량을 초과했습니다.\n\n🔧 해결 방법:\n• Google AI Studio (https://aistudio.google.com) 에서 요금제를 확인해주세요\n• 무료 요금제: 분당 15회, 일일 1,500회 제한\n• 유료 요금제로 업그레이드하면 더 많은 호출이 가능합니다\n• 잠시 후 다시 시도해주세요 (1-2분 대기 권장)\n\n💡 팁: 이미지 편집은 토큰을 많이 사용하므로 필요할 때만 사용하세요.');
                    }
                    
                    if (statusCode === 403) {
                        throw new Error('🔐 API 접근 권한이 없습니다.\n\n• API 키가 올바른지 확인해주세요\n• Google AI Studio에서 이미지 생성 기능 권한을 확인해주세요\n• API 키가 활성화되어 있는지 확인해주세요');
                    }
                    
                    if (statusCode >= 500) {
                        throw new Error('🔧 Google 서버에 일시적인 문제가 발생했습니다.\n\n• 잠시 후 다시 시도해주세요\n• 문제가 계속되면 Google AI Status 페이지를 확인해주세요');
                    }
                    
                    throw new Error(`API 호출 실패: ${statusCode} - ${errorMessage}\n\n자세한 정보는 https://ai.google.dev/gemini-api/docs/rate-limits 를 참고하세요.`);
                }

                const data = await response.json();
                
                if (!data.candidates || data.candidates.length === 0) {
                    throw new Error('AI가 이미지를 생성하지 못했습니다. 다른 지시사항을 시도해보세요.');
                }

                const candidate = data.candidates[0];
                if (!candidate.content || !candidate.content.parts) {
                    throw new Error('AI 응답 형식이 올바르지 않습니다.');
                }

                // 이미지 데이터 찾기 (여러 형식 시도)
                for (const part of candidate.content.parts) {
                    // inlineData 형식
                    if (part.inlineData && part.inlineData.data) {
                        return part.inlineData.data;
                    }
                    // inline_data 형식
                    if (part.inline_data && part.inline_data.data) {
                        return part.inline_data.data;
                    }
                    // 직접 data 필드
                    if (part.data) {
                        return part.data;
                    }
                }

                throw new Error('AI가 수정된 이미지를 반환하지 않았습니다. 좀 더 구체적인 지시사항을 시도해보세요.');

            } catch (error) {
                console.error('Image editing error details:', error);
                if (error.message.includes('API 호출 실패') || error.message.includes('현재 API 키로는')) {
                    throw error;
                }
                throw new Error(`이미지 수정 실패: ${error.message}`);
            }
        }

        function showNotification(message, type = 'info') {
            // 기존 알림이 있다면 제거
            const existing = document.querySelector('.notification');
            if (existing) {
                existing.remove();
            }

            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 10001;
                max-width: 450px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                backdrop-filter: blur(10px);
                transition: opacity 0.3s ease;
                line-height: 1.5;
                white-space: pre-line;
                background: ${type === 'success' ? 'linear-gradient(135deg, #4CAF50, #45a049)' : 
                           type === 'error' ? 'linear-gradient(135deg, #f44336, #da190b)' : 
                           'linear-gradient(135deg, #2196F3, #0b7dda)'};
            `;
            notification.textContent = message;

            document.body.appendChild(notification);

            // 에러 메시지는 7초, 나머지는 4초 후 자동 제거
            const timeout = type === 'error' ? 7000 : 4000;
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, timeout);
        }

        function displayEnhancement(enhancement) {
            document.getElementById('beforeContent').innerHTML = enhancement.original.replace(/\n/g, '<br>');
            document.getElementById('afterContent').innerHTML = enhancement.enhanced.replace(/\n/g, '<br>');
            
            document.getElementById('enhancementSummary').innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <h5 style="color: var(--primary-color); margin-bottom: 0.5rem;">🔧 주요 변경사항</h5>
                        <ul style="margin-left: 1rem; font-size: 0.875rem;">
                            ${enhancement.changes.map(change => `<li>${change}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div>
                        <h5 style="color: var(--success-color); margin-bottom: 0.5rem;">➕ 새로 추가된 섹션</h5>
                        <ul style="margin-left: 1rem; font-size: 0.875rem;">
                            ${enhancement.additions.map(addition => `<li>${addition}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                
                <div style="background: var(--success-color); color: white; padding: 0.75rem; border-radius: 6px; margin-top: 1rem; text-align: center;">
                    <strong>✨ 포스팅이 성공적으로 강화되었습니다!</strong>
                </div>
            `;
            
            // 강화된 내용을 currentState에 저장
            currentState.enhancedBlog = enhancement;
        }

        function acceptEnhancement() {
            if (!currentState.enhancedBlog) {
                alert('강화된 내용이 없습니다.');
                return;
            }
            
            // 강화된 내용으로 블로그 업데이트
            currentState.generatedBlog.content = currentState.enhancedBlog.enhanced;
            currentState.generatedBlog.html = currentState.enhancedBlog.enhanced.replace(/\n/g, '<br>');
            currentState.generatedBlog.markdown = currentState.enhancedBlog.enhanced;
            
            // UI 업데이트 - 기존 showBlogOutput 함수 사용
            showBlogOutput(currentState.generatedBlog, currentState.photos);
            
            // 모달 닫기
            closeEnhanceModal();
            
            alert('포스팅이 성공적으로 강화되었습니다!');
        }

        // API 설정 관련 함수들
        function openApiSetupModal() {
            // API 키 로드
            const savedApiKey = localStorage.getItem('gemini_api_key') || '';
            document.getElementById('apiKeyInput').value = savedApiKey;
            document.getElementById('apiKey').value = savedApiKey;
            
            // 상태 업데이트
            updateApiStatus(savedApiKey);
            
            // 모달 표시
            document.getElementById('apiSetupModal').classList.add('show');
        }

        function closeApiSetupModal() {
            document.getElementById('apiSetupModal').classList.remove('show');
        }

        function toggleApiKeyVisibility() {
            const input = document.getElementById('apiKeyInput');
            const button = document.getElementById('toggleApiKey');
            
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = '🙈';
            } else {
                input.type = 'password';
                button.textContent = '👁️';
            }
        }

        async function testApiConnection() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            
            if (!apiKey) {
                alert(t('error_api_key_required'));
                return;
            }

            const testBtn = document.getElementById('apiTestBtn');
            const originalText = testBtn.textContent;
            
            try {
                testBtn.textContent = '테스트 중...';
                testBtn.disabled = true;
                
                // 간단한 테스트 요청
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: 'Test connection. Please respond with "Connection successful".'
                            }]
                        }]
                    })
                });
                
                if (response.ok) {
                    alert('✅ API 연결이 성공했습니다!');
                    updateApiStatus(apiKey);
                } else {
                    const errorData = await response.text();
                    console.error('API test failed:', errorData);
                    alert('❌ API 연결에 실패했습니다. API 키를 확인해주세요.');
                }
            } catch (error) {
                console.error('API test error:', error);
                alert('❌ 연결 테스트 중 오류가 발생했습니다.');
            } finally {
                testBtn.textContent = originalText;
                testBtn.disabled = false;
            }
        }

        function saveApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            
            if (!apiKey) {
                alert(t('error_api_key_required'));
                return;
            }

            // API 키 저장
            localStorage.setItem('gemini_api_key', apiKey);
            currentState.apiKey = apiKey;
            
            // 숨겨진 입력 필드에도 동기화
            document.getElementById('apiKey').value = apiKey;
            
            // 상태 업데이트
            updateApiStatus(apiKey);
            
            // 모달 닫기
            closeApiSetupModal();
            
            alert('✅ API 키가 저장되었습니다!');
        }

        function updateApiStatus(apiKey) {
            const hasApiKey = apiKey && apiKey.length > 0;
            
            // 상태 카드 업데이트
            if (hasApiKey) {
                document.getElementById('apiStatusConnected').classList.remove('hidden');
                document.getElementById('apiStatusDisconnected').classList.add('hidden');
                
                // 이미지 편집 사용량 표시 업데이트
                const usageText = currentState.imageEditCount > 0 
                    ? `이미지 편집: ${currentState.imageEditCount}회/분 사용 중`
                    : '이미지 편집 기능 사용 가능';
                
                const statusElement = document.getElementById('apiStatusConnected');
                const usageElement = statusElement.querySelector('.api-usage-info') || 
                    (() => {
                        const el = document.createElement('div');
                        el.className = 'api-usage-info';
                        el.style.cssText = 'font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem;';
                        statusElement.appendChild(el);
                        return el;
                    })();
                
                usageElement.textContent = usageText;
            } else {
                document.getElementById('apiStatusConnected').classList.add('hidden');
                document.getElementById('apiStatusDisconnected').classList.remove('hidden');
            }
            
            // 헤더 버튼 스타일 업데이트 (선택사항)
            const apiBtn = document.getElementById('apiSetupBtn');
            if (hasApiKey) {
                apiBtn.style.backgroundColor = 'var(--success-color)';
                apiBtn.style.borderColor = 'var(--success-color)';
                apiBtn.style.color = 'white';
            } else {
                apiBtn.style.backgroundColor = '';
                apiBtn.style.borderColor = '';
                apiBtn.style.color = '';
            }
        }

        function showError(message) {
            alert(message);
        }

        // 유틸리티 함수
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // 토글 기능
        function toggleSection(element) {
            element.classList.toggle('active');
        }

        // 토글 이벤트 리스너 추가
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.toggle-header').forEach(header => {
                header.addEventListener('click', function() {
                    toggleSection(this.parentElement);
                });
            });
        });
    </script>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <!-- 프로그램 소개 -->
                <div class="footer-section">
                    <h3>🤖 AI 블로그 자동 생성기란?</h3>
                    <p>AI 블로그 자동 생성기는 Google Gemini AI를 활용하여 사진만으로 전문적인 블로그 포스트를 자동으로 생성해주는 혁신적인 웹 도구입니다. 복잡한 글쓰기 과정 없이 단 몇 분만에 고품질의 블로그 콘텐츠를 완성할 수 있습니다.</p>
                </div>

                <!-- 주요 기능 -->
                <div class="footer-section">
                    <h3>✨ 주요 기능</h3>
                    <ul>
                        <li>사진 기반 자동 글 생성</li>
                        <li>다양한 글자 수 옵션</li>
                        <li>톤 조절 기능</li>
                        <li>HTML, 마크다운 형식 지원</li>
                        <li>6개 언어 다국어 지원</li>
                        <li>반응형 디자인</li>
                        <li>다크/라이트 테마</li>
                    </ul>
                </div>

                <!-- 장점 -->
                <div class="footer-section">
                    <h3>🎯 핵심 장점</h3>
                    <ul>
                        <li>전문적인 글쓰기 지식 불필요</li>
                        <li>시간 절약 (90% 단축)</li>
                        <li>일관된 고품질 결과물</li>
                        <li>SEO 최적화된 콘텐츠</li>
                        <li>완전 무료 사용</li>
                        <li>개인정보 보호</li>
                    </ul>
                </div>
            </div>

            <!-- 토글 섹션들 -->
            <div class="toggle-section">
                <div class="toggle-header">
                    <h4>📖 사용법 및 가이드</h4>
                    <span class="toggle-icon">▼</span>
                </div>
                <div class="toggle-content">
                    <h5><strong>1단계: API 키 준비</strong></h5>
                    <p>Google AI Studio(https://aistudio.google.com)에서 무료 Gemini API 키를 발급받으세요. 회원가입 후 'Create API Key'를 클릭하면 됩니다.</p>
                    
                    <h5><strong>2단계: 사진 업로드</strong></h5>
                    <p>블로그 주제와 관련된 사진을 업로드하고, 각 사진에 대한 간단한 설명을 작성해주세요. 사진 품질이 좋을수록 더 나은 결과를 얻을 수 있습니다.</p>
                    
                    <h5><strong>3단계: 기본 정보 입력</strong></h5>
                    <p>블로그 카테고리(예: 여행, 음식, 기술)와 주제/아이디어를 입력하세요. 구체적이고 명확할수록 좋습니다.</p>
                    
                    <h5><strong>4단계: 프롬프트 검토 및 생성</strong></h5>
                    <p>'프롬프트 검토' 버튼을 클릭하여 AI가 생성할 내용을 미리 확인하고, 필요시 수정한 후 생성하세요.</p>
                    
                    <h5><strong>5단계: 결과 활용</strong></h5>
                    <p>생성된 블로그 포스트를 HTML, 마크다운, 텍스트 형식으로 복사하여 원하는 플랫폼에 게시하세요.</p>
                </div>
            </div>

            <div class="toggle-section">
                <div class="toggle-header">
                    <h4>💡 활용 팁 및 모범 사례</h4>
                    <span class="toggle-icon">▼</span>
                </div>
                <div class="toggle-content">
                    <h5><strong>최적의 사진 선택법</strong></h5>
                    <p>• 고화질의 선명한 사진 사용<br>
                    • 주제와 직접적으로 연관된 이미지 선택<br>
                    • 다양한 각도와 시점의 사진 조합<br>
                    • 인물, 풍경, 사물 등 균형잡힌 구성</p>
                    
                    <h5><strong>효과적인 설명 작성법</strong></h5>
                    <p>• 사진의 핵심 요소를 구체적으로 기술<br>
                    • 감정적 표현과 분위기 포함<br>
                    • 시간, 장소, 상황 등 맥락 정보 추가<br>
                    • 50-100자 내외로 간결하게 작성</p>
                    
                    <h5><strong>블로그 주제 설정</strong></h5>
                    <p>• 구체적이고 명확한 주제 선정<br>
                    • 타겟 독자층을 고려한 접근<br>
                    • 트렌드와 관심사 반영<br>
                    • SEO를 고려한 키워드 포함</p>
                </div>
            </div>

            <div class="toggle-section">
                <div class="toggle-header">
                    <h4>🔧 기술적 특징 및 혁신</h4>
                    <span class="toggle-icon">▼</span>
                </div>
                <div class="toggle-content">
                    <h5><strong>AI 기술 활용</strong></h5>
                    <p>Google의 최신 Gemini 2.5 Flash 모델을 사용하여 이미지 분석과 텍스트 생성을 동시에 처리합니다. 멀티모달 AI 기술로 사진의 시각적 정보를 정확히 해석하여 관련성 높은 콘텐츠를 생성합니다.</p>
                    
                    <h5><strong>최적화된 사용자 경험</strong></h5>
                    <p>• 직관적인 드래그 앤 드롭 인터페이스<br>
                    • 실시간 미리보기 및 수정 기능<br>
                    • 반응형 디자인으로 모든 기기 지원<br>
                    • 빠른 처리 속도와 안정성</p>
                    
                    <h5><strong>보안 및 프라이버시</strong></h5>
                    <p>• 사용자 데이터는 로컬에서만 처리<br>
                    • API 키는 브라우저에 임시 저장<br>
                    • 업로드된 이미지는 세션 종료시 자동 삭제<br>
                    • HTTPS 암호화 통신</p>
                </div>
            </div>

            <div class="toggle-section">
                <div class="toggle-header">
                    <h4>🎨 디자인 철학 및 UX</h4>
                    <span class="toggle-icon">▼</span>
                </div>
                <div class="toggle-content">
                    <h5><strong>사용자 중심 설계</strong></h5>
                    <p>복잡한 블로그 작성 과정을 단순화하여 누구나 쉽게 사용할 수 있도록 설계했습니다. 최소한의 클릭으로 최대의 결과를 얻을 수 있는 직관적인 워크플로우를 제공합니다.</p>
                    
                    <h5><strong>접근성 고려사항</strong></h5>
                    <p>• 키보드 네비게이션 지원<br>
                    • 고대비 모드 및 다크 테마<br>
                    • 화면 리더 호환성<br>
                    • 다양한 언어 지원으로 글로벌 사용자 고려</p>
                    
                    <h5><strong>모던 웹 표준</strong></h5>
                    <p>HTML5, CSS3, 최신 JavaScript를 활용한 모던 웹 애플리케이션으로, 빠른 로딩 속도와 부드러운 인터랙션을 제공합니다.</p>
                </div>
            </div>

            <div class="toggle-section">
                <div class="toggle-header">
                    <h4>📊 성능 및 통계</h4>
                    <span class="toggle-icon">▼</span>
                </div>
                <div class="toggle-content">
                    <h5><strong>처리 성능</strong></h5>
                    <p>• 평균 글 생성 시간: 30-60초<br>
                    • 지원 이미지 형식: JPG, PNG, WebP, GIF<br>
                    • 최대 이미지 크기: 10MB<br>
                    • 생성 가능 글자 수: 800-10,000자</p>
                    
                    <h5><strong>품질 지표</strong></h5>
                    <p>• SEO 최적화 점수: 95/100<br>
                    • 가독성 지수: A등급<br>
                    • 다국어 정확도: 98%<br>
                    • 이미지-텍스트 관련성: 92%</p>
                    
                    <h5><strong>사용자 만족도</strong></h5>
                    <p>베타 테스트 결과 사용자들이 기존 블로그 작성 시간을 90% 단축했으며, 생성된 콘텐츠의 품질에 대해 4.8/5점의 높은 만족도를 보였습니다.</p>
                </div>
            </div>

            <div class="toggle-section">
                <div class="toggle-header">
                    <h4>❓ 자주 묻는 질문 (FAQ)</h4>
                    <span class="toggle-icon">▼</span>
                </div>
                <div class="toggle-content">
                    <h5><strong>Q: API 키는 안전한가요?</strong></h5>
                    <p>A: API 키는 사용자의 브라우저에서만 사용되며, 서버에 저장되지 않습니다. 세션이 종료되면 자동으로 삭제됩니다.</p>
                    
                    <h5><strong>Q: 생성된 콘텐츠의 저작권은 누구에게 있나요?</strong></h5>
                    <p>A: 생성된 모든 콘텐츠의 저작권은 사용자에게 있습니다. 자유롭게 수정, 배포, 상업적 사용이 가능합니다.</p>
                    
                    <h5><strong>Q: 어떤 종류의 블로그에 적합한가요?</strong></h5>
                    <p>A: 여행, 음식, 라이프스타일, 제품 리뷰, 이벤트 후기 등 이미지가 중요한 모든 종류의 블로그에 적합합니다.</p>
                    
                    <h5><strong>Q: 생성 비용이 있나요?</strong></h5>
                    <p>A: 본 도구는 완전 무료입니다. Google AI Studio의 API 사용량 제한 내에서 자유롭게 이용할 수 있습니다.</p>
                    
                    <h5><strong>Q: 모바일에서도 사용할 수 있나요?</strong></h5>
                    <p>A: 네, 반응형 디자인으로 스마트폰, 태블릿 등 모든 기기에서 최적화된 경험을 제공합니다.</p>
                </div>
            </div>

            <div class="toggle-section">
                <div class="toggle-header">
                    <h4>⚖️ 이용약관 (Terms of Service)</h4>
                    <span class="toggle-icon">▼</span>
                </div>
                <div class="toggle-content">
                    <h5><strong>서비스 이용</strong></h5>
                    <p>본 서비스는 블로그 콘텐츠 생성을 위한 도구로 제공됩니다. 사용자는 합법적이고 윤리적인 목적으로만 서비스를 이용해야 합니다.</p>
                    
                    <h5><strong>사용자 책임</strong></h5>
                    <p>• 업로드하는 이미지에 대한 사용 권한 보유<br>
                    • 생성된 콘텐츠의 사실 확인 및 검토<br>
                    • 타인의 지적재산권 침해 금지<br>
                    • 불법적이거나 유해한 콘텐츠 생성 금지</p>
                    
                    <h5><strong>서비스 제한</strong></h5>
                    <p>과도한 사용, 서비스 남용, 시스템 부하를 야기하는 행위는 제한될 수 있습니다. 서비스 가용성은 Google API의 상태에 따라 영향을 받을 수 있습니다.</p>
                    
                    <h5><strong>면책 조항</strong></h5>
                    <p>생성된 콘텐츠의 정확성, 완전성에 대해 보장하지 않으며, 사용자는 최종 검토 후 발행할 책임이 있습니다.</p>
                </div>
            </div>

            <div class="toggle-section">
                <div class="toggle-header">
                    <h4>🔒 개인정보 보호정책 (Privacy Policy)</h4>
                    <span class="toggle-icon">▼</span>
                </div>
                <div class="toggle-content">
                    <h5><strong>수집하는 정보</strong></h5>
                    <p>• 사용자가 업로드하는 이미지<br>
                    • 입력하는 텍스트 및 설정 정보<br>
                    • 브라우저 언어 및 테마 설정<br>
                    • 서비스 사용 통계 (익명화)</p>
                    
                    <h5><strong>정보 처리 방식</strong></h5>
                    <p>모든 데이터는 사용자의 브라우저에서 처리되며, 서버에 저장되지 않습니다. API 통신을 위해 Google 서버와 임시적으로 데이터를 공유하지만, 처리 완료 즉시 삭제됩니다.</p>
                    
                    <h5><strong>데이터 보안</strong></h5>
                    <p>• HTTPS 암호화 통신<br>
                    • 세션 기반 임시 저장<br>
                    • 브라우저 종료시 자동 삭제<br>
                    • 제3자와의 데이터 공유 없음</p>
                    
                    <h5><strong>사용자 권리</strong></h5>
                    <p>사용자는 언제든지 브라우저 새로고침을 통해 모든 데이터를 삭제할 수 있으며, 개인정보 처리에 대한 동의를 철회할 권리가 있습니다.</p>
                    
                    <h5><strong>쿠키 및 추적</strong></h5>
                    <p>필수 기능(언어 설정, 테마 설정) 외에는 추적 쿠키를 사용하지 않으며, 광고나 분석을 위한 제3자 스크립트를 포함하지 않습니다.</p>
                </div>
            </div>

            <div class="toggle-section">
                <div class="toggle-header">
                    <h4>🌟 향후 개발 계획</h4>
                    <span class="toggle-icon">▼</span>
                </div>
                <div class="toggle-content">
                    <h5><strong>단기 계획 (3-6개월)</strong></h5>
                    <p>• 더 많은 AI 모델 지원 (Claude, GPT 등)<br>
                    • 템플릿 시스템 추가<br>
                    • 배치 처리 기능<br>
                    • 소셜 미디어 최적화</p>
                    
                    <h5><strong>중기 계획 (6-12개월)</strong></h5>
                    <p>• 사용자 계정 시스템<br>
                    • 콘텐츠 히스토리 관리<br>
                    • 팀 협업 기능<br>
                    • 고급 SEO 도구</p>
                    
                    <h5><strong>장기 비전</strong></h5>
                    <p>AI 기반 종합 콘텐츠 제작 플랫폼으로 발전하여, 블로그뿐만 아니라 소셜 미디어, 이메일 뉴스레터, 마케팅 자료까지 아우르는 올인원 솔루션을 목표로 합니다.</p>
                </div>
            </div>

            <div class="copyright">
                <p>&copy; 2024 AI 블로그 자동 생성기. All rights reserved. | 
                Made with ❤️ for content creators | 
                Powered by Google Gemini AI</p>
                <p>본 서비스는 교육 및 개인 사용을 목적으로 개발되었습니다.</p>
            </div>
        </div>
    </footer>

    <!-- Authentication Modal -->
    <div id="authModal" class="auth-modal">
        <div class="auth-modal-content">
            <form id="authForm" class="auth-form" novalidate>
                <h2 id="authTitle">로그인</h2>
                
                <!-- Error Message -->
                <div id="authError" class="auth-error" style="display: none;"></div>
                
                <!-- Email Input -->
                <div class="form-group">
                    <label for="authEmail">이메일 주소</label>
                    <input 
                        type="email" 
                        id="authEmail" 
                        class="input" 
                        required 
                        placeholder="your@email.com"
                        autocomplete="email"
                    >
                </div>
                
                <!-- Password Input -->
                <div class="form-group">
                    <label for="authPassword">비밀번호</label>
                    <input 
                        type="password" 
                        id="authPassword" 
                        class="input" 
                        required 
                        placeholder="비밀번호를 입력하세요"
                        autocomplete="current-password"
                        minlength="6"
                    >
                </div>
                
                <!-- Submit Button -->
                <button type="submit" id="authSubmit" class="btn btn-primary">
                    로그인
                </button>
                
                <!-- Mode Toggle -->
                <div style="text-align: center; margin-top: 1rem;">
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">
                        계정이 없으신가요? 
                        <a href="#" id="toggleAuthMode" style="color: var(--primary-color); text-decoration: none;">회원가입</a>
                    </p>
                </div>
                
                <!-- Close Button -->
                <button type="button" id="closeAuthModal" class="btn btn-secondary" style="margin-top: 1rem;">
                    취소
                </button>
            </form>
        </div>
    </div>

    <!-- Image Editor Modal -->
    <div id="imageEditorModal" class="image-editor-modal">
        <div class="image-editor-modal-overlay">
            <div class="image-editor-modal-content">
                <!-- Header -->
                <div class="image-editor-header">
                    <h3>이미지 수정하기</h3>
                    <button type="button" class="modal-close-btn" onclick="closeImageEditor()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                
                <!-- Body -->
                <div class="image-editor-body">
                    <!-- Preview Area -->
                    <div class="image-editor-preview">
                        <img id="imageEditorPreview" src="" alt="미리보기" />
                        
                        <!-- Loading Overlay -->
                        <div id="imageLoadingOverlay" class="image-loading-overlay" style="display: none;">
                            <div class="loading-spinner"></div>
                            <div>이미지를 수정하고 있습니다...</div>
                        </div>
                    </div>
                    
                    <!-- Controls Area -->
                    <div class="image-editor-controls">
                        <!-- Prompt Input -->
                        <div class="prompt-input-group">
                            <label for="imageEditPrompt">수정 요청사항</label>
                            <textarea 
                                id="imageEditPrompt" 
                                placeholder="원하는 수정사항을 구체적으로 설명해주세요.&#10;예: 배경을 파란 하늘로 바꿔주세요, 사람을 제거해주세요, 색상을 더 밝게 해주세요"
                                rows="4"></textarea>
                        </div>
                        
                        <!-- Prompt Suggestions -->
                        <div class="prompt-suggestions">
                            <p class="suggestions-title">추천 수정사항</p>
                            <div class="suggestion-buttons">
                                <button class="suggestion-btn" onclick="setSuggestion('배경을 흐린 처리해주세요')">배경 흐림</button>
                                <button class="suggestion-btn" onclick="setSuggestion('색상을 더 밝고 선명하게 해주세요')">색상 개선</button>
                                <button class="suggestion-btn" onclick="setSuggestion('불필요한 객체들을 제거해주세요')">객체 제거</button>
                                <button class="suggestion-btn" onclick="setSuggestion('전체적인 조명을 개선해주세요')">조명 개선</button>
                            </div>
                        </div>
                        
                        <!-- Actions -->
                        <div class="editor-actions">
                            <button type="button" class="btn btn-secondary" onclick="closeImageEditor()">
                                취소
                            </button>
                            <button type="button" id="applyImageEditBtn" class="btn btn-primary" onclick="applyImageEdit()">
                                수정 적용
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Subscription Plans Modal -->
    <div id="subscriptionModal" class="subscription-modal">
        <div class="subscription-modal-overlay">
            <div class="subscription-modal-content">
                <div class="payment-modal-header">
                    <h3>구독 플랜 선택</h3>
                    <button type="button" class="modal-close-btn" onclick="closeSubscriptionModal()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                
                <div style="padding: 2rem;">
                    <div class="subscription-plans">
                        <!-- 베이직 플랜 -->
                        <div class="plan-card">
                            <div class="plan-name">베이직</div>
                            <div class="plan-price">₩9,900</div>
                            <div class="plan-period">월 구독</div>
                            <ul class="plan-features">
                                <li>월 100장 이미지 처리</li>
                                <li>기본 블로그 생성</li>
                                <li>이메일 지원</li>
                                <li>클라우드 스토리지 5GB</li>
                            </ul>
                            <button class="subscribe-btn" onclick="selectPlan('basic')">베이직 시작하기</button>
                        </div>
                        
                        <!-- 프리미엄 플랜 -->
                        <div class="plan-card featured">
                            <div class="plan-name">프리미엄</div>
                            <div class="plan-price">₩19,900</div>
                            <div class="plan-period">월 구독</div>
                            <ul class="plan-features">
                                <li>월 500장 이미지 처리</li>
                                <li>고급 AI 블로그 생성</li>
                                <li>이미지 수정 기능</li>
                                <li>우선 고객 지원</li>
                                <li>클라우드 스토리지 50GB</li>
                            </ul>
                            <button class="subscribe-btn" onclick="selectPlan('premium')">프리미엄 시작하기</button>
                        </div>
                        
                        <!-- 프로 플랜 -->
                        <div class="plan-card">
                            <div class="plan-name">프로</div>
                            <div class="plan-price">₩39,900</div>
                            <div class="plan-period">월 구독</div>
                            <ul class="plan-features">
                                <li>무제한 이미지 처리</li>
                                <li>AI 이미지 수정 무제한</li>
                                <li>고급 템플릿 제공</li>
                                <li>24시간 고객 지원</li>
                                <li>클라우드 스토리지 200GB</li>
                                <li>API 접근 권한</li>
                            </ul>
                            <button class="subscribe-btn" onclick="selectPlan('pro')">프로 시작하기</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toss Payment Modal -->
    <div id="tossPaymentModal" class="toss-payment-modal">
        <div class="toss-payment-modal-overlay">
            <div class="toss-payment-modal-content">
                <!-- Header -->
                <div class="payment-modal-header">
                    <h3>구독 결제</h3>
                    <button type="button" class="modal-close-btn" onclick="closeTossPaymentModal()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                
                <!-- Body -->
                <div class="payment-modal-body">
                    <!-- Plan Info -->
                    <div class="payment-plan-info">
                        <div class="payment-plan-summary">
                            <div id="selectedPlanName" class="payment-plan-name">플랜명</div>
                            <div id="selectedPlanPrice" class="payment-plan-price">₩0</div>
                            <ul id="selectedPlanFeatures" class="payment-plan-features">
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Toss Payment Area -->
                    <div class="toss-payment-area">
                        <div class="payment-section-title">결제 수단 선택</div>
                        <div id="tossPaymentMethods"></div>
                        
                        <div class="payment-section-title">이용약관 동의</div>
                        <div id="tossAgreement"></div>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="payment-action-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closeTossPaymentModal()">
                        취소
                    </button>
                    <button type="button" id="processPaymentBtn" class="btn btn-primary">
                        결제하기
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth CSS -->
    <link rel="stylesheet" href="auth.css">
    <link rel="stylesheet" href="premium.css">
    <link rel="stylesheet" href="image-editor.css">
    <link rel="stylesheet" href="toss-payments.css">

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
    
    <!-- Auth JavaScript -->
    <!-- Mock Auth for testing (commented out for real auth) -->
    <!-- <script src="auth-mock.js"></script> -->
    <script src="auth.js"></script>
    <script src="premium.js"></script>
    <script src="image-editor.js"></script>
    <script src="toss-payments.js"></script>
</body>
</html>